<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Miku.dev | Home</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="/styles.css" />
  <style>
    /* New canvas for digital pixel stage scenery background */
    #stageCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -3;
      background-color: #000;
    }
    /* Ensure the other canvases appear above the stage if needed */
    #soundWaveCanvas {
      z-index: -2;
    }
  </style>
</head>
<body>
  <!-- Existing canvas (if used) -->
  <canvas id="soundWaveCanvas" aria-hidden="true"></canvas>
  <!-- New Stage Canvas -->
  <canvas id="stageCanvas" aria-hidden="true"></canvas>
  
  <div class="page-container" id="pageContainer">
    <!-- Title Bar -->
    <header class="title-bar" id="titleBar">
      <div class="container">
        <div class="left-section"></div>
        <div class="title-wrapper">
          <a href="/" aria-label="Home" class="logo-link">
            <span class="site-title">Miku.dev</span>
            <div class="visualizer-wrapper">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 100" class="visualizer">
                <g>
                  <rect x="10" y="70" width="15" height="30" fill="#00c6ff">
                    <animate attributeName="height" values="30;60;30" dur="0.8s" repeatCount="indefinite" />
                    <animate attributeName="y" values="70;40;70" dur="0.8s" repeatCount="indefinite" />
                  </rect>
                  <rect x="35" y="60" width="15" height="40" fill="#ff4081">
                    <animate attributeName="height" values="40;80;40" dur="1s" repeatCount="indefinite" />
                    <animate attributeName="y" values="60;20;60" dur="1s" repeatCount="indefinite" />
                  </rect>
                  <rect x="60" y="80" width="15" height="20" fill="#00c6ff">
                    <animate attributeName="height" values="20;50;20" dur="0.6s" repeatCount="indefinite" />
                    <animate attributeName="y" values="80;50;80" dur="0.6s" repeatCount="indefinite" />
                  </rect>
                  <rect x="85" y="50" width="15" height="50" fill="#ff4081">
                    <animate attributeName="height" values="50;90;50" dur="1.2s" repeatCount="indefinite" />
                    <animate attributeName="y" values="50;10;50" dur="1.2s" repeatCount="indefinite" />
                  </rect>
                  <rect x="110" y="70" width="15" height="30" fill="#00c6ff">
                    <animate attributeName="height" values="30;60;30" dur="0.9s" repeatCount="indefinite" />
                    <animate attributeName="y" values="70;40;70" dur="0.9s" repeatCount="indefinite" />
                  </rect>
                  <rect x="135" y="60" width="15" height="40" fill="#ff4081">
                    <animate attributeName="height" values="40;80;40" dur="1.1s" repeatCount="indefinite" />
                    <animate attributeName="y" values="60;20;60" dur="1.1s" repeatCount="indefinite" />
                  </rect>
                </g>
              </svg>
            </div>
          </a>
        </div>
        <div class="right-section">
          <button class="menu-button" id="menuButton" aria-label="Open Menu">
            <i class="fas fa-music"></i>
          </button>
        </div>
      </div>
    </header>
    
    <nav class="overlay-menu" id="overlayMenu">
      <button class="close-overlay" id="closeOverlay" aria-label="Close Menu">
        <i class="fas fa-times"></i>
      </button>
      <div class="overlay-content">
        <a href="/auth" aria-label="Admin Login"><i class="fas fa-user-lock"></i> Admin Login</a>
        <a href="#aboutMe" aria-label="About Me"><i class="fas fa-info-circle"></i> About Me</a>
        <div class="personality-options">
          <button id="personalityOption1" class="personality-button"><i class="fas fa-music"></i> Melody</button>
          <button id="personalityOption2" class="personality-button"><i class="fas fa-headphones"></i> Harmony</button>
          <button id="personalityOption3" class="personality-button"><i class="fas fa-microphone"></i> Rhythm</button>
        </div>
      </div>
    </nav>
    
    <section class="now-playing-container">
      <div id="nowPlayingBox" class="now-playing">
        <aside class="now-playing-sidebar">
          <div class="sidebar-item">
            <i class="fas fa-tv"></i> <span id="channelName">Loading...</span>
          </div>
          <div class="sidebar-item">
            <i class="fas fa-eye"></i> <span id="viewCount">Loading...</span>
          </div>
          <div class="sidebar-item">
            <i class="fas fa-thumbs-up"></i> <span id="likeCount">Loading...</span>
          </div>
          <div class="sidebar-item">
            <i class="fas fa-calendar-day"></i> <span id="publishedDate">Loading...</span>
          </div>
          <div class="sidebar-item video-category">
            <i class="fas fa-tag"></i> <span id="videoCategory">Loading...</span>
          </div>
          <hr class="animated-divider" />
          <section class="clock-section">
            <p id="greeting" class="greeting">
              <i class="fas fa-sun"></i>
              <span id="greeting-text">Good Morning!</span>
            </p>
            <div class="clocks-container">
              <div class="digital-clock">
                <p id="local-time"><i class="fas fa-clock"></i> 00:03:56</p>
                <p id="current-date"><i class="fas fa-calendar-alt"></i> 14 October 2024</p>
                <p id="day-of-week"><i class="fas fa-calendar-day"></i> Monday</p>
                <p id="time-zone"><i class="fas fa-globe"></i> UTC</p>
              </div>
            </div>
            <p id="last-visit-message" class="last-visit-message"><i class="fas fa-history"></i> Welcome back!</p>
          </section>
        </aside>
        <div class="video-section">
          <div id="videoInfoContainer" class="video-info-container">
            <div class="video-title-container">
              <h2>Currently Playing</h2>
              <p id="videoTitle">Loading...</p>
            </div>
            <div class="thumbnail-container">
              <video id="videoThumbnail" class="video-thumbnail" preload="metadata" controls aria-label="Currently Playing Video">
                Your browser does not support the video tag.
              </video>
              <img id="videoThumbnailImage" src="" alt="Thumbnail" class="video-thumbnail" loading="lazy" />
            </div>
          </div>
          <div id="offline-indicator" class="offline-indicator">
            <i class="fas fa-signal-slash"></i> I’m currently offline
          </div>
          <div class="progress-bar-container">
            <div id="progressBar" class="progress-bar"></div>
          </div>
          <div class="live-indicator-container">
            <svg id="liveIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="30" height="30" aria-label="Live Stream Indicator" class="live-icon" role="img" aria-labelledby="liveTitle">
              <title id="liveTitle">Live Stream Indicator</title>
              <circle cx="50" cy="50" r="40" fill="#FF0000" opacity="0.9" />
              <text x="50%" y="55%" text-anchor="middle" fill="#FFFFFF" font-size="12" font-family="Arial, sans-serif" dy=".3em">LIVE</text>
            </svg>
          </div>
          <div id="timeElapsedContainer" class="time-elapsed">
            <i class="fas fa-clock"></i> <span id="timeElapsed">0s</span>
          </div>
          <button class="toggle-description" id="toggleDescriptionButton" aria-label="Toggle Description">
            <i class="fas fa-info-circle"></i> Show Description
          </button>
          <div id="loadingSpinner" class="loading-spinner" aria-label="Loading">
            <i class="fas fa-spinner fa-spin"></i>
          </div>
        </div>
        <hr class="animated-divider" />
        <aside class="weather-section">
          <img id="weather-icon" src="" alt="Weather Icon" class="weather-icon" loading="lazy" />
          <p id="weather-description" class="weather-description"><i class="fas fa-cloud-sun"></i> Loading...</p>
          <p id="temperature" class="temperature"><i class="fas fa-temperature-high"></i> --°C</p>
          <p id="humidity" class="humidity"><i class="fas fa-tint"></i> Humidity: --%</p>
          <p id="wind-speed" class="wind-speed"><i class="fas fa-wind"></i> Wind: -- m/s</p>
        </aside>
      </div>
    </section>
    <section class="content-wrapper">
      <div class="now-playing-about-wrapper">
        <div class="about" id="aboutMe">
          <h2>About Me</h2>
          <p>Hey there, I'm Hystoriya, a 24-year-old developer. This is my personal website that I made for no apparent reason. If you find yourself here randomly, then hi :)</p>
        </div>
      </div>
    </section>
    <footer class="footer">
      <div class="container">
        <p>&copy; 2024 MikuMiku. All rights reserved.</p>
        <button id="manageConsentFooter" class="manage-consent-button">
          <i class="fas fa-cookie-bite"></i> Manage Cookie Preferences
        </button>
      </div>
    </footer>
    <div id="chat-box" class="chat-box closed" role="dialog" aria-labelledby="chatHeader" aria-modal="true">
      <div class="chat-header">
        <div class="chat-logo">
          <svg width="32" height="32" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <path d="M10 10 H90 V70 H70 L50 90 L30 70 H10 Z" fill="#ffffff" stroke="#007BFF" stroke-width="5" />
          </svg>
        </div>
        <h3 id="chatHeader">Haru AI</h3>
        <button id="close-chat" class="close-chat" aria-label="Close Chat">
          <svg width="24" height="24" viewBox="0 0 20 20" fill="#ffffff" xmlns="http://www.w3.org/2000/svg">
            <path d="M10 8.586L3.536 2.122 2.122 3.536 8.586 10l-6.464 6.464 1.414 1.414L18.344 17.656C19.792 16.208 20.688 14.21 20.688 12c0-5.514-4.486-10-10-10zm0 14l-3-3H5v-2h4v2zm0-4H5v-2h4v2zm6-4h-8v2h8V8z" />
          </svg>
        </button>
      </div>
      <div id="chat-content" class="chat-content" role="log" aria-live="polite">
        <div class="message bot-message">
          <div class="message-content">
            <svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="#007BFF" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10c2.21 0 4.208-.896 5.656-2.344L20 18.414V20h1.586l-1.414-1.414L18.344 17.656C19.792 16.208 20.688 14.21 20.688 12c0-5.514-4.486-10-10-10zm-1 14H7v-2h4v2zm0-4H7v-2h4v2zm6-4h-8v2h8V8z" />
            </svg>
            Hi! I'm Haru, how can I help you today?
          </div>
        </div>
      </div>
      <div id="chat-loading" class="chat-loading" aria-hidden="true">
        <svg class="spinner" width="24" height="24" viewBox="0 0 50 50">
          <circle class="path" cx="25" cy="25" r="20" fill="none" stroke="#007BFF" stroke-width="5"></circle>
        </svg>
        <span>Thinking...</span>
      </div>
      <div class="chat-input-container">
        <input type="text" id="chat-input" class="chat-input" placeholder="Type your message..." aria-label="Chat Input">
        <button id="send-message" class="send-message" aria-label="Send Message">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="#ffffff" xmlns="http://www.w3.org/2000/svg">
            <path d="M2.01 21L23 12 2.01 3v7l15 2-15 2z" />
          </svg>
        </button>
      </div>
    </div>
    <button id="open-chat" class="open-chat-button" aria-label="Open Chat">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="#ffffff" xmlns="http://www.w3.org/2000/svg">
        <path d="M20 2H4C2.897 2 2 2.897 2 4v12c0 1.103.897 2 2 2h5l4 4 4-4h5c1.103 0 2-.897 2-2V4c0-1.103-.897-2-2-2zm0 14l-3-3H5V4h15v12z" />
      </svg>
    </button>
    <div id="descriptionModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="descriptionModalTitle" aria-describedby="descriptionModalDescription">
      <div class="modal-content">
        <button class="close-button" id="closeDescriptionButton" aria-label="Close Description Modal"><i class="fas fa-times"></i></button>
        <h2 id="descriptionModalTitle">Description</h2>
        <p id="descriptionModalDescription">Loading description...</p>
      </div>
    </div>
    <div id="consentModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="consentModalTitle" aria-describedby="consentModalDescription">
      <div class="modal-content">
        <button class="close-button" id="closeConsentModal" aria-label="Close Consent Modal"><i class="fas fa-times"></i></button>
        <h2 id="consentModalTitle"><i class="fas fa-cookie"></i> Cookie Consent</h2>
        <p id="consentModalDescription">
          I use cookies stored in your browser to enhance your experience on my personal website. These cookies are essential for the website's functionality. By clicking "Accept," you consent to their use. You can also manage your cookie preferences in the "Manage Cookie Preferences" section.
        </p>
        <div class="consent-buttons">
          <button id="acceptConsent" class="consent-button"><i class="fas fa-check"></i> Accept</button>
          <button id="declineConsent" class="consent-button"><i class="fas fa-times"></i> Decline</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- External Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.1/socket.io.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <script src="haru.js"></script>
  <script src="clockwork.js"></script>
  
  <script>
    window.addEventListener("load", function() {
      document.getElementById("pageContainer").classList.add("loaded");
    });
  </script>
  
  <!-- Site Functionality Scripts (menu, chat, clock, weather, etc.) -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var titleBar = document.getElementById('titleBar');
      if (titleBar) {
        window.addEventListener('scroll', function () {
          if (window.scrollY > 50) {
            titleBar.classList.add('scrolled');
          } else {
            titleBar.classList.remove('scrolled');
          }
        });
      }
      var menuButton = document.getElementById('menuButton'),
          overlayMenu = document.getElementById('overlayMenu'),
          closeOverlay = document.getElementById('closeOverlay');
      if (menuButton && overlayMenu) {
        menuButton.addEventListener('click', function (e) {
          e.stopPropagation();
          overlayMenu.classList.add('active');
          document.body.classList.add('overlay-active');
        });
      }
      if (closeOverlay && overlayMenu) {
        closeOverlay.addEventListener('click', function (e) {
          e.stopPropagation();
          overlayMenu.classList.remove('active');
          document.body.classList.remove('overlay-active');
        });
      }
      window.addEventListener('click', function (event) {
        if (event.target === overlayMenu) {
          overlayMenu.classList.remove('active');
          document.body.classList.remove('overlay-active');
        }
      });
      var personalityButtons = document.querySelectorAll('.personality-button'),
          siteTitle = document.querySelector('.site-title');
      if (personalityButtons.length > 0 && siteTitle) {
        personalityButtons.forEach(function (button) {
          button.addEventListener('click', function () {
            var personality = button.textContent.trim();
            switch (personality) {
              case 'Melody':
                siteTitle.style.color = '#ff4081';
                break;
              case 'Harmony':
                siteTitle.style.color = '#00c6ff';
                break;
              case 'Rhythm':
                siteTitle.style.color = '#ffffff';
                break;
              default:
                siteTitle.style.color = '#00c6ff';
            }
            personalityButtons.forEach(function (btn) {
              btn.classList.remove('active');
            });
            button.classList.add('active');
          });
        });
      }
    });
  </script>
  
  <!-- (Consent, Socket.IO, Chat, etc. scripts remain unchanged) -->
  
  <!-- New: Hatsune Miku Themed Digital Pixel Stage Scenery Background Script -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const canvas = document.getElementById('stageCanvas');
      const ctx = canvas.getContext('2d');
      let offsetY = 0;
      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);
      // Parameters for the grid
      const cols = 20;
      const rows = 30;
      const cellWidth = canvas.width / cols;
      const cellHeight = canvas.height / rows;
      // Vanishing point near top-center
      const vanishX = canvas.width / 2;
      const vanishY = canvas.height * 0.3;
      function drawStage() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        // Draw horizontal lines with vertical offset (scrolling effect)
        ctx.strokeStyle = "#00C6FF";
        ctx.lineWidth = 2;
        for (let i = 0; i <= rows; i++) {
          let y = vanishY + (canvas.height - vanishY) * (i / rows) + offsetY;
          if (y > canvas.height) y = vanishY + (y - canvas.height);
          ctx.beginPath();
          ctx.moveTo(0, y);
          ctx.lineTo(canvas.width, y);
          ctx.stroke();
        }
        // Draw vertical lines converging at the vanishing point
        for (let i = 0; i <= cols; i++) {
          let x = i * cellWidth;
          ctx.beginPath();
          ctx.moveTo(x, canvas.height);
          ctx.lineTo(vanishX, vanishY);
          ctx.stroke();
        }
        offsetY += 1;
        if (offsetY > cellHeight) offsetY = 0;
        requestAnimationFrame(drawStage);
      }
      drawStage();
    });
  </script>
</body>
</html>
