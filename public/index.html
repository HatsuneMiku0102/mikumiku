<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Miku.dev | Home</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <link rel="stylesheet" href="/styles.css"/>
    <style>
      .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);opacity:0;visibility:hidden;transition:opacity .2s ease;z-index:1000}
      .backdrop.active{opacity:1;visibility:visible}
      .modal-description{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(.98);max-width:640px;width:90%;background:#111;color:#fff;padding:1rem 1.25rem;border-radius:14px;box-shadow:0 20px 60px rgba(0,0,0,.5);z-index:1001;opacity:0;pointer-events:none;transition:opacity .2s ease,transform .2s ease}
      .modal-description.active{opacity:1;transform:translate(-50%,-50%) scale(1);pointer-events:auto}
      body.modal-open{overflow:hidden}
      .modal-description h4{margin:0 0 .5rem 0}
      .transition-layer{position:absolute;inset:0;background:linear-gradient(135deg,rgba(0,198,255,.12),rgba(255,64,129,.12));backdrop-filter:blur(2px);opacity:0;pointer-events:none;transition:opacity .25s ease;z-index:5}
      .transition-layer.active{opacity:1;pointer-events:auto}
      .youtube-section.entering .video-thumb,.youtube-section.entering .video-details{filter:blur(3px);transform:scale(.98);transition:all .25s ease}
      .video-details .animate-in{opacity:0;transform:translateY(8px);animation:fadeInUp .5s ease forwards}
      .video-details .animate-in.delay-1{animation-delay:.08s}
      .video-details .animate-in.delay-2{animation-delay:.16s}
      .video-details .animate-in.delay-3{animation-delay:.24s}
      .video-details .animate-in.delay-4{animation-delay:.32s}
      .video-thumb .thumb-img{opacity:0;transform:scale(.96);animation:popIn .45s ease forwards}
      @keyframes fadeInUp{to{opacity:1;transform:translateY(0)}}
      @keyframes popIn{to{opacity:1;transform:scale(1)}}
      .skeleton{position:relative;overflow:hidden;background:rgba(255,255,255,.08);border-radius:8px}
      .skeleton::after{content:"";position:absolute;inset:0;transform:translateX(-100%);background:linear-gradient(90deg,transparent,rgba(255,255,255,.15),transparent);animation:shimmer 1.1s infinite}
      @keyframes shimmer{100%{transform:translateX(100%)}}
      .skeleton.title{height:20px;width:70%}
      .skeleton.line{height:12px;width:50%}
      .progress-bar{position:relative;overflow:hidden}
      .progress-bar #progressBar{transition:width .25s ease}
      .history-wrap{margin-top:12px}
      .history-header{display:flex;align-items:center;gap:.5rem;font-weight:700;opacity:.9}
      .history-scroller{margin-top:8px;display:grid;grid-auto-flow:column;grid-auto-columns:140px;gap:10px;overflow-x:auto;padding-bottom:6px;scrollbar-width:thin}
      .hist-item{background:rgba(255,255,255,.06);border-radius:12px;padding:8px;display:flex;flex-direction:column;gap:6px;cursor:pointer;transition:transform .15s ease,background .15s ease}
      .hist-item:hover{transform:translateY(-2px);background:rgba(255,255,255,.1)}
      .hist-thumb{width:100%;aspect-ratio:16/9;object-fit:cover;border-radius:8px}
      .hist-title{font-size:.8rem;line-height:1.2;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
      .hist-meta{font-size:.7rem;opacity:.7}
    </style>
  </head>
  <body>
    <canvas id="soundWaveCanvas" aria-hidden="true"></canvas>
    <div class="page-container" id="pageContainer">
      <header class="title-bar" id="titleBar">
        <div class="container">
          <div class="left-section"></div>
          <div class="title-wrapper">
            <a href="/" aria-label="Home" class="logo-link">
              <span class="site-title">Miku.dev</span>
              <div class="visualizer-wrapper">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 100" class="visualizer">
                  <g>
                    <rect x="10" y="70" width="15" height="30" fill="#00c6ff">
                      <animate attributeName="height" values="30;60;30" dur="0.8s" repeatCount="indefinite"/>
                      <animate attributeName="y" values="70;40;70" dur="0.8s" repeatCount="indefinite"/>
                    </rect>
                    <rect x="35" y="60" width="15" height="40" fill="#ff4081">
                      <animate attributeName="height" values="40;80;40" dur="1s" repeatCount="indefinite"/>
                      <animate attributeName="y" values="60;20;60" dur="1s" repeatCount="indefinite"/>
                    </rect>
                    <rect x="60" y="80" width="15" height="20" fill="#00c6ff">
                      <animate attributeName="height" values="20;50;20" dur="0.6s" repeatCount="indefinite"/>
                      <animate attributeName="y" values="80;50;80" dur="0.6s" repeatCount="indefinite"/>
                    </rect>
                    <rect x="85" y="50" width="15" height="50" fill="#ff4081">
                      <animate attributeName="height" values="50;90;50" dur="1.2s" repeatCount="indefinite"/>
                      <animate attributeName="y" values="50;10;50" dur="1.2s" repeatCount="indefinite"/>
                    </rect>
                    <rect x="110" y="70" width="15" height="30" fill="#00c6ff">
                      <animate attributeName="height" values="30;60;30" dur="0.9s" repeatCount="indefinite"/>
                      <animate attributeName="y" values="70;40;70" dur="0.9s" repeatCount="indefinite"/>
                    </rect>
                    <rect x="135" y="60" width="15" height="40" fill="#ff4081">
                      <animate attributeName="height" values="40;80;40" dur="1.1s" repeatCount="indefinite"/>
                      <animate attributeName="y" values="60;20;60" dur="1.1s" repeatCount="indefinite"/>
                    </rect>
                  </g>
                </svg>
              </div>
            </a>
          </div>
          <div class="right-section">
            <button class="menu-button" id="menuButton" aria-label="Open Menu">
              <i class="fas fa-music"></i>
            </button>
          </div>
        </div>
      </header>
      <nav class="overlay-menu" id="overlayMenu">
        <button class="close-overlay" id="closeOverlay" aria-label="Close Menu">
          <i class="fas fa-times"></i>
        </button>
        <div class="overlay-content">
          <a href="/auth" aria-label="Admin Login"><i class="fas fa-user-lock"></i> Admin Login</a>
          <a href="#aboutMe" aria-label="About Me"><i class="fas fa-info-circle"></i> About Me</a>
          <div class="personality-options">
            <button id="personalityOption1" class="personality-button"><i class="fas fa-music"></i> Melody</button>
            <button id="personalityOption2" class="personality-button"><i class="fas fa-headphones"></i> Harmony</button>
            <button id="personalityOption3" class="personality-button"><i class="fas fa-microphone"></i> Rhythm</button>
          </div>
        </div>
      </nav>
      <section class="now-playing-container">
        <div class="now-playing-card" id="nowPlayingCard">
          <div class="now-playing-grid">
            <div class="video-info">
              <div class="info-item"><i class="fas fa-tv"></i><span id="channelName">Loading…</span></div>
              <div class="info-item"><i class="fas fa-eye"></i><span id="viewCount">Loading…</span></div>
              <div class="info-item"><i class="fas fa-thumbs-up"></i><span id="likeCount">Loading…</span></div>
              <div class="info-item"><i class="fas fa-calendar-day"></i><span id="publishedDate">Loading…</span></div>
              <div class="info-item"><i class="fas fa-tag"></i><span id="videoCategory">Loading…</span></div>
            </div>
            <div class="time-info">
              <div class="greeting-container">
                <p class="greeting"><i class="fas fa-sun"></i> <span id="greeting-text">Good Morning!</span></p>
              </div>
              <div class="clock-container">
                <div class="digital-clock">
                  <p id="local-time"><i class="fas fa-clock"></i> 00:00:00</p>
                  <p id="current-date"><i class="fas fa-calendar-alt"></i> 1 January 2025</p>
                  <p id="day-of-week"><i class="fas fa-calendar-day"></i> Wednesday</p>
                  <p id="time-zone"><i class="fas fa-globe"></i> UTC</p>
                </div>
              </div>
            </div>
            <div class="youtube-section" id="youtubeSection" style="position: relative;">
              <div class="transition-layer" id="ytTransition"></div>
              <div class="video-thumb">
                <img id="videoThumbnailImage" class="thumb-img" src="" alt="Thumbnail" loading="lazy"/>
                <div id="thumbSkeleton" class="skeleton" style="position:absolute;inset:0;display:none;"></div>
              </div>
              <div class="video-details">
                <h3 class="animate-in">Currently Playing</h3>
                <p id="videoTitle" class="animate-in delay-1">Loading…</p>
                <div class="progress-bar animate-in delay-2"><div id="progressBar"></div></div>
                <div class="animate-in delay-3">
                  <button id="toggleDescriptionButton"><i class="fas fa-info-circle"></i> Show Description</button>
                </div>
                <div id="backdrop" class="backdrop" aria-hidden="true"></div>
                <div id="descriptionModal" class="modal-description" role="dialog" aria-modal="true" aria-labelledby="descriptionModalTitle" aria-describedby="descriptionModalDescription">
                  <h4 id="descriptionModalTitle">Description</h4>
                  <p id="descriptionModalDescription">Loading description…</p>
                </div>
                <div id="titleSkeleton" class="skeleton title" style="margin-top:.5rem;display:none;"></div>
                <div id="lineSkeleton" class="skeleton line" style="margin-top:.5rem;display:none;"></div>
              </div>
              <div class="status-boxes">
                <div id="liveIndicator" class="status-box live">Live</div>
                <div id="pauseIndicator" class="status-box paused">Paused</div>
              </div>
            </div>
            <aside class="weather-info" style="grid-area: weatherSection;">
              <img id="weather-icon" src="" alt="Weather Icon" loading="lazy"/>
              <p id="weather-description">Loading…</p>
              <p id="temperature">--°C</p>
              <p id="humidity">Humidity: --%</p>
              <p id="wind-speed">Wind: -- m/s</p>
            </aside>
            <div class="history-wrap">
              <div class="history-header"><i class="fas fa-clock"></i> Recent</div>
              <div id="historyScroller" class="history-scroller"></div>
            </div>
          </div>
          <div id="offline-indicator" class="offline-indicator"><i class="fas fa-signal-slash"></i> Offline</div>
        </div>
      </section>
      <footer class="footer">
        <div class="container">
          <p>&copy; 2024 MikuMiku. All rights reserved.</p>
          <button id="manageConsentFooter" class="manage-consent-button"><i class="fas fa-cookie-bite"></i> Manage Cookie Preferences</button>
        </div>
      </footer>
      <div id="consentModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="consentModalTitle" aria-describedby="consentModalDescription">
        <div class="modal-content">
          <button class="close-button" id="closeConsentModal" aria-label="Close Consent Modal"><i class="fas fa-times"></i></button>
          <h2 id="consentModalTitle"><i class="fas a-cookie"></i> Cookie Consent</h2>
          <p id="consentModalDescription">I use cookies stored in your browser to enhance your experience on my personal website. These cookies are essential for the website's functionality. By clicking "Accept," you consent to their use. You can also manage your cookie preferences in the "Manage Cookie Preferences" section.</p>
          <div class="consent-buttons">
            <button id="acceptConsent" class="consent-button"><i class="fas fa-check"></i> Accept</button>
            <button id="declineConsent" class="consent-button"><i class="fas fa-times"></i> Decline</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.1/socket.io.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="haru.js"></script>
    <script src="clockwork.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("pageContainer");e&&e.classList.add("loaded");const t=document.getElementById("titleBar");t&&window.addEventListener("scroll",function(){t.classList.toggle("scrolled",window.scrollY>50)});const n=document.getElementById("menuButton"),o=document.getElementById("overlayMenu"),a=document.getElementById("closeOverlay");n&&o&&n.addEventListener("click",function(e){e.stopPropagation(),o.classList.add("active"),document.body.classList.add("overlay-active")}),a&&o&&a.addEventListener("click",function(e){e.stopPropagation(),o.classList.remove("active"),document.body.classList.remove("overlay-active")}),window.addEventListener("click",function(e){e.target===o&&(o.classList.remove("active"),document.body.classList.remove("overlay-active"))});const i=document.querySelectorAll(".personality-button"),d=document.querySelector(".site-title");i.length&&d&&i.forEach(e=>{e.addEventListener("click",function(){const t=e.textContent.trim();"Melody"===t?d.style.color="#ff4081":"Harmony"===t?d.style.color="#00c6ff":"Rhythm"===t?d.style.color="#ffffff":d.style.color="#00c6ff",i.forEach(e=>e.classList.remove("active")),e.classList.add("active")})})});
    </script>

    <script>
      (function(){const e={consentCookieName:"cookieConsent",consentCookieExpiryDays:365,consentCookiePath:"/",consentModalId:"consentModal",acceptButtonId:"acceptConsent",declineButtonId:"declineConsent",manageButtonIds:["manageConsentFooter"],closeButtonId:"closeConsentModal",cookieCategories:{necessary:{enabled:true,description:"Necessary cookies enable core functionalities and security features of the website."}},focusableSelectors:"button, [href], input, select, textarea, [tabindex]:not([tabindex='-1'])"};const t=document.getElementById(e.consentModalId),n=document.getElementById(e.acceptButtonId),o=document.getElementById(e.declineButtonId),a=document.getElementById(e.closeButtonId),c=e.manageButtonIds.map(e=>document.getElementById(e));function s(t,n,o,a){let c="";if(n){const e=new Date;e.setTime(e.getTime()+24*n*60*60*1e3),c="; expires="+e.toUTCString()}const s="https:"===location.protocol?"; Secure":"",l="; SameSite=Lax";document.cookie=t+"="+(o||"")+c+"; path="+a+s+l}function l(e){const t=e+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){let o=n[e].trim();if(0===o.indexOf(t))return o.substring(t.length)}return null}function r(e){document.cookie=e+"=; Max-Age=-99999999; path=/;"}function d(e){const n=e.querySelectorAll(u),o=n.length?n[0]:null,a=n.length?n[n.length-1]:null;e.addEventListener("keydown",function(e){"Tab"===e.key&&(e.shiftKey?document.activeElement===o&&(e.preventDefault(),a.focus()):document.activeElement===a&&(e.preventDefault(),o.focus())),"Escape"===e.key&&e.preventDefault()})}function m(){t.classList.add("active"),document.body.classList.add("modal-active"),t.setAttribute("aria-hidden","false");const e=t.querySelectorAll(u);e.length&&e[0].focus(),d(t)}function g(){t.classList.remove("active"),document.body.classList.remove("modal-active"),t.setAttribute("aria-hidden","true")}function f(){const t=l(e.consentCookieName);t?v(t):m(),n&&n.addEventListener("click",function(){s(e.consentCookieName,JSON.stringify({necessary:true}),e.consentCookieExpiryDays,e.consentCookiePath),g(),h()}),o&&o.addEventListener("click",function(){s(e.consentCookieName,JSON.stringify({necessary:false}),e.consentCookieExpiryDays,e.consentCookiePath),g(),p()}),c.forEach(e=>{e&&e.addEventListener("click",function(e){e.preventDefault(),m()})}),a&&a.addEventListener("click",function(){alert("Please make a choice regarding cookie usage.")}),window.addEventListener("click",function(e){e.target===t&&alert("Please make a choice regarding cookie usage.")})}function v(t){try{const n=JSON.parse(t);n.necessary?h(n):p()}catch(e){m()}}function h(e){}function p(){}function y(){const t="test_cookie_consent";s(t,"test",1,"/");const n="test"===l(t);return r(t),n}document.addEventListener("DOMContentLoaded",function(){y()?f():console.warn("Cookies are disabled in this browser. Consent modal will not be displayed.")});const u=e.focusableSelectors})();
    </script>

    <script>
      document.addEventListener("DOMContentLoaded",function(){const e=localStorage.getItem("currentVideoTitle"),t=localStorage.getItem("currentVideoThumbnail");if(e){const t=document.getElementById("videoTitle");t&&(t.textContent=e)}if(t){const e=document.getElementById("videoThumbnailImage");e&&(e.src=t,e.style.display="block")}const n=localStorage.getItem("currentVideoChannel"),o=localStorage.getItem("currentVideoViews"),a=localStorage.getItem("currentVideoLikes"),i=localStorage.getItem("currentVideoPublished"),d=localStorage.getItem("currentVideoCategory"),l=localStorage.getItem("currentVideoDescription"),c=document.getElementById("channelName"),s=document.getElementById("viewCount"),r=document.getElementById("likeCount"),m=document.getElementById("publishedDate"),g=document.getElementById("videoCategory"),f=document.getElementById("descriptionModalDescription");c&&n&&(c.textContent=n),s&&o&&(s.textContent=o),r&&a&&(r.textContent=a),m&&i&&(m.textContent=i),g&&d&&(g.textContent=d),f&&l&&(f.textContent=l)});
    </script>

    <script>
      document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("toggleDescriptionButton"),t=document.getElementById("descriptionModal"),n=document.getElementById("backdrop");function o(){t.classList.add("active"),n.classList.add("active"),document.body.classList.add("modal-open"),localStorage.setItem("descriptionModalOpen","true")}function a(){t.classList.remove("active"),n.classList.remove("active"),document.body.classList.remove("modal-open"),localStorage.setItem("descriptionModalOpen","false")}if(localStorage.getItem("descriptionModalOpen")==="true"){o()}else{a()}e.addEventListener("click",function(){t.classList.contains("active")?a():o()});n.addEventListener("click",a);document.addEventListener("keydown",function(e){if(e.key==="Escape"&&t.classList.contains("active"))a()})});
    </script>

    <script>
      document.addEventListener("DOMContentLoaded",function(){function e(){const e=new Date,t=e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),n=document.getElementById("local-time");n&&(n.textContent=t);const o=e.toLocaleDateString(void 0,{day:"2-digit",month:"long",year:"numeric"}),a=document.getElementById("current-date");a&&(a.textContent=o);const i=e.toLocaleDateString(void 0,{weekday:"long"}),d=document.getElementById("day-of-week");d&&(d.textContent=i)}setInterval(e,1e3),e()});
    </script>

    <script>
      document.addEventListener("DOMContentLoaded",function(){async function e(){try{const e=await fetch("/api/weather?city="+encodeURIComponent("Leeds")),t=await e.json();if(t.error)throw new Error(t.error);n(t)}catch(e){const t=document.getElementById("weather-icon");t&&(t.style.display="none");const n=document.getElementById("weather-description");n&&(n.innerText="Unable to fetch weather data.")}}function n(e){const n=e.weather[0].description,o=Math.round(e.main.temp),a=e.main.humidity,i=e.wind.speed,d=e.weather[0].icon,l="https://openweathermap.org/img/wn/"+d+"@2x.png";document.getElementById("weather-description").innerText="Condition: "+n,document.getElementById("temperature").innerText="Temperature: "+o+"°C",document.getElementById("humidity").innerText="Humidity: "+a+"%",document.getElementById("wind-speed").innerText="Wind: "+i+" m/s";const c=document.getElementById("weather-icon");c&&(c.src=l,c.style.display="block")}setInterval(e,3600000),e()});
    </script>

    <script>
      document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("soundWaveCanvas"),t=e.getContext("2d");function n(){e.width=window.innerWidth,e.height=window.innerHeight}n(),window.addEventListener("resize",function(){n(),m=Math.floor(e.width/d),g=new Array(m).fill(0),h=Array.from({length:m},()=>Math.random()*.05+.05),p=new Array(m).fill(0),v=new Array(m).fill("0")});const d=20;let m=Math.floor(e.width/d),g=new Array(m).fill(0),h=Array.from({length:m},()=>Math.random()*.05+.05),p=new Array(m).fill(0),v=new Array(m).fill("0");const o="01",a=["#00C6FF","#ff4081"],i=["Hatsune Miku","The First Sound of the Future","39","Digital Diva","CV01","01"];function l(e,t){const n=parseInt(e.slice(1,3),16),o=parseInt(e.slice(3,5),16),a=parseInt(e.slice(5,7),16);return"rgba("+n+", "+o+", "+a+", "+t+")"}function c(){t.fillStyle="rgba(0, 0, 0, 0.05)",t.fillRect(0,0,e.width,e.height),t.font=d+"px monospace",t.shadowColor="rgba(0, 0, 0, 0.8)",t.shadowBlur=4;const n=6;for(let s=0;s<g.length;s++){let r=h[s];let u;if(p[s]>0)r=0,p[s]--;if(0===p[s]&&Math.random()<.002){u=i[Math.floor(Math.random()*i.length)],t.fillStyle="#FF69B4",p[s]=180,r=.2*h[s]}else{Math.random()<.1&&(v[s]=o.charAt(Math.floor(Math.random()*o.length))),u=v[s],t.fillStyle=a[s%a.length]}const w=s*d,f=Math.floor(g[s])*d;t.fillText(u,w,f);for(let e=1;e<n;e++){const n=f-e*d;if(n<0)break;const i=1-e/n;t.fillStyle=l(a[s%a.length],i),t.fillText(o.charAt(Math.floor(Math.random()*o.length)),w,n)}f>e.height&&Math.random()>.995&&(g[s]=0,h[s]=Math.random()*.05+.05,p[s]=0,v[s]="0"),g[s]+=r}requestAnimationFrame(c)}c()});
    </script>

    <script>
      document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("nowPlayingCard"),t=document.getElementById("youtubeSection"),n=document.getElementById("offline-indicator"),o=document.getElementById("videoTitle"),a=document.getElementById("videoThumbnailImage"),i=document.getElementById("thumbSkeleton"),d=document.getElementById("titleSkeleton"),l=document.getElementById("lineSkeleton"),c=document.getElementById("channelName"),s=document.getElementById("viewCount"),r=document.getElementById("likeCount"),m=document.getElementById("publishedDate"),g=document.getElementById("videoCategory"),f=document.getElementById("progressBar"),v=document.getElementById("liveIndicator"),h=document.getElementById("pauseIndicator"),p=document.getElementById("descriptionModalDescription"),y=document.getElementById("toggleDescriptionButton"),u=document.getElementById("ytTransition"),S=document.getElementById("historyScroller");let w=null;let E=null;let T=null;function A(e){return e==null?null:Number(e)}function C(e){return e===true||e==="true"||e===1||e==="1"}function L(e){if(!f)return;const t=C(e.isLive);if(t){f.style.width="100%";return}const n=A(e.duration),o=A(e.currentTime),a=A(e.percent);if(typeof n==="number"&&n>0&&typeof o==="number"&&o>=0){const e=Math.max(0,Math.min(100,(o/n)*100));f.style.width=e+"%";E=e}else if(typeof a==="number"&&!isNaN(a)){const e=Math.max(0,Math.min(100,a));f.style.width=e+"%";E=e}else if(E==null){f.style.width="0%"}}
function N(e){const t=C(e.isLive),n=C(e.isPaused);v&&v.classList.toggle("active",t),h&&h.classList.toggle("active",n)}
function O(){n&&n.classList.remove("visible"),e&&e.classList.remove("offline"),t&&(t.style.display="block")}
function D(e){w=e.videoId||null,o&&(o.textContent=e.title||""),c&&(c.textContent=e.channelTitle||""),s&&(s.textContent=R(e.viewCount)),r&&(r.textContent=R(e.likeCount)),m&&(m.textContent=e.publishedAt?new Date(e.publishedAt).toLocaleDateString():m.textContent),g&&(g.textContent=e.category||""),p&&(p.textContent=e.description||""),a&&(e.thumbnail?(a.removeAttribute("loading"),a.src=e.thumbnail,a.style.display="block"):a.style.display=""),O(),L(e),N(e),y&&(y.style.display="block"),localStorage.setItem("currentVideoTitle",o?o.textContent:""),localStorage.setItem("currentVideoThumbnail",a&&a.src?a.src:""),localStorage.setItem("currentVideoChannel",c?c.textContent:""),localStorage.setItem("currentVideoViews",s?s.textContent:""),localStorage.setItem("currentVideoLikes",r?r.textContent:""),localStorage.setItem("currentVideoPublished",m?m.textContent:""),localStorage.setItem("currentVideoCategory",g?g.textContent:""),localStorage.setItem("currentVideoDescription",p?p.textContent:""),a.classList.remove("thumb-img"),void a.offsetWidth,a.classList.add("thumb-img");const q=document.querySelectorAll(".video-details .animate-in");q.forEach(x=>{x.style.opacity="0";x.style.transform="translateY(8px)";void x.offsetWidth;x.classList.add("animate-in")});k(e)}
function R(e){if(typeof e==="string")e=e.replace(/,/g,"");const t=Number(e);return isNaN(t)?"N/A":t.toLocaleString()}
function P(){n&&n.classList.add("visible"),e&&e.classList.add("offline")}
function M(e){t.classList.add("entering");u.classList.add("active");i.style.display="block";d.style.display="block";l.style.display="block";const n=new Image;const s=new Promise(r=>{n.onload=()=>r(true);n.onerror=()=>r(false);if(e.thumbnail)n.src=e.thumbnail});const o=new Promise(r=>setTimeout(()=>r(false),800));Promise.race([s,o]).then(()=>{D(e);setTimeout(()=>{u.classList.remove("active");t.classList.remove("entering");i.style.display="none";d.style.display="none";l.style.display="none"},180)})}
function H(){const e=localStorage.getItem("npHistory");try{return e?JSON.parse(e):[]}catch{return[]}}
function j(e){const t=H().filter(x=>x.videoId!==e.videoId);t.unshift({videoId:e.videoId||"",title:e.title||"",thumbnail:e.thumbnail||"",channelTitle:e.channelTitle||"",publishedAt:e.publishedAt||"",category:e.category||""});const n=t.slice(0,20);localStorage.setItem("npHistory",JSON.stringify(n));B(n)}
function B(e){S.innerHTML="";e.forEach(t=>{const n=document.createElement("div");n.className="hist-item";n.dataset.videoId=t.videoId;const o=document.createElement("img");o.className="hist-thumb";o.src=t.thumbnail||"";const a=document.createElement("div");a.className="hist-title";a.textContent=t.title||"";const i=document.createElement("div");i.className="hist-meta";i.textContent=t.channelTitle||"";n.appendChild(o);n.appendChild(a);n.appendChild(i);n.addEventListener("click",function(){o&&o.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"});const d={videoId:t.videoId,title:t.title,thumbnail:t.thumbnail,channelTitle:t.channelTitle,viewCount:s?s.textContent:"",likeCount:r?r.textContent:"",publishedAt:t.publishedAt,category:t.category,description:p?p.textContent:"",duration:0,currentTime:0,isLive:false,isPaused:true};D(d)});S.appendChild(n)})}
function k(e){if(!e||!e.videoId)return;j(e)}
function F(){B(H())}
async function V(){if(!w)return;const e=v&&v.classList.contains("active");if(!e)return;try{const t=await fetch("/api/youtube/stats?videoId="+encodeURIComponent(w));if(!t.ok)return;const n=await t.json();if(typeof n.viewCount!=="undefined"&&s)s.textContent=R(n.viewCount);if(typeof n.likeCount!=="undefined"&&r)r.textContent=R(n.likeCount)}catch{}}
function G(){if(T){clearInterval(T);T=null}const e=v&&v.classList.contains("active");if(e){T=setInterval(V,10000)}}
const W=io();W.on("connect",function(){O()}),W.on("disconnect",function(){P()}),W.on("presenceUpdate",function(e){"offline"===e.presenceType?P():"video"===e.presenceType?(e.videoId===w?(O(),L(e),N(e)):(M(e),G())):"browsing"===e.presenceType?(o&&(o.textContent=e.title||o.textContent),a&&(e.thumbnail?(a.src=e.thumbnail,a.style.display="block"):a.style.display=""),O(),N({isLive:false,isPaused:false})):void 0});setTimeout(function(){if(!o||!o.textContent||o.textContent==="Loading…"){const e=localStorage.getItem("currentVideoTitle");if(e&&o)o.textContent=e}},0);F();setInterval(G,5000)});
    </script>
  </body>
</html>
