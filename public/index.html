<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Miku.dev | Home</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <canvas id="soundWaveCanvas" aria-hidden="true"></canvas>
  <div class="page-container" id="pageContainer">
    <header class="title-bar" id="titleBar">
      <div class="container flex-between">
        <a href="/" aria-label="Home" class="logo-link flex-center">
          <span class="site-title">Miku.dev</span>
          <svg class="visualizer" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 100">
            <g>
              <rect x="10" y="70" width="15" height="30" fill="#00c6ff">
                <animate attributeName="height" values="30;60;30" dur="0.8s" repeatCount="indefinite"/>
                <animate attributeName="y" values="70;40;70" dur="0.8s" repeatCount="indefinite"/>
              </rect>
              <rect x="35" y="60" width="15" height="40" fill="#ff4081">
                <animate attributeName="height" values="40;80;40" dur="1s" repeatCount="indefinite"/>
                <animate attributeName="y" values="60;20;60" dur="1s" repeatCount="indefinite"/>
              </rect>
              <rect x="60" y="80" width="15" height="20" fill="#00c6ff">
                <animate attributeName="height" values="20;50;20" dur="0.6s" repeatCount="indefinite"/>
                <animate attributeName="y" values="80;50;80" dur="0.6s" repeatCount="indefinite"/>
              </rect>
              <rect x="85" y="50" width="15" height="50" fill="#ff4081">
                <animate attributeName="height" values="50;90;50" dur="1.2s" repeatCount="indefinite"/>
                <animate attributeName="y" values="50;10;50" dur="1.2s" repeatCount="indefinite"/>
              </rect>
              <rect x="110" y="70" width="15" height="30" fill="#00c6ff">
                <animate attributeName="height" values="30;60;30" dur="0.9s" repeatCount="indefinite"/>
                <animate attributeName="y" values="70;40;70" dur="0.9s" repeatCount="indefinite"/>
              </rect>
              <rect x="135" y="60" width="15" height="40" fill="#ff4081">
                <animate attributeName="height" values="40;80;40" dur="1.1s" repeatCount="indefinite"/>
                <animate attributeName="y" values="60;20;60" dur="1.1s" repeatCount="indefinite"/>
              </rect>
            </g>
          </svg>
        </a>
        <button id="menuButton" class="menu-button" aria-label="Open Menu"><i class="fas fa-music"></i></button>
      </div>
    </header>
    <nav id="overlayMenu" class="overlay-menu">
      <button id="closeOverlay" class="close-overlay" aria-label="Close Menu"><i class="fas fa-times"></i></button>
      <div class="overlay-content">
        <a href="/auth"><i class="fas fa-user-lock"></i> Admin Login</a>
        <a href="#aboutMe"><i class="fas fa-info-circle"></i> About Me</a>
        <div class="personality-options flex-center">
          <button data-color="#ff4081" class="personality-button"><i class="fas fa-music"></i> Melody</button>
          <button data-color="#00c6ff" class="personality-button"><i class="fas fa-headphones"></i> Harmony</button>
          <button data-color="#ffffff" class="personality-button"><i class="fas fa-microphone"></i> Rhythm</button>
        </div>
      </div>
    </nav>
    <main class="now-playing-container modern-card">
      <div id="nowPlayingBox" class="grid-modern">
        <section class="video-info">
          <div class="info-item"><i class="fas fa-tv"></i><span id="channelName">Loading...</span></div>
          <div class="info-item"><i class="fas fa-eye"></i><span id="viewCount">Loading...</span></div>
          <div class="info-item"><i class="fas fa-thumbs-up"></i><span id="likeCount">Loading...</span></div>
          <div class="info-item"><i class="fas fa-calendar-day"></i><span id="publishedDate">Loading...</span></div>
          <div class="info-item"><i class="fas fa-tag"></i><span id="videoCategory">Loading...</span></div>
        </section>
        <section class="clock-and-greeting">
          <p id="greeting"><i class="fas fa-sun"></i><span id="greeting-text">Good Morning!</span></p>
          <div class="digital-clock">
            <p id="local-time"><i class="fas fa-clock"></i> 00:00:00</p>
            <p id="current-date"><i class="fas fa-calendar-alt"></i> --</p>
            <p id="day-of-week"><i class="fas fa-calendar-day"></i> --</p>
            <p id="time-zone"><i class="fas fa-globe"></i> UTC</p>
          </div>
          <p id="last-visit-message"><i class="fas fa-history"></i> Welcome back!</p>
        </section>
        <section id="youtubeSection" class="youtube-section">
          <h2>Currently Playing</h2>
          <p id="videoTitle">Loading...</p>
          <img id="videoThumbnailImage" class="thumbnail" src="" alt="Thumbnail" />
          <div class="progress-modern">
            <div id="progressBar" class="progress-bar"></div>
            <div class="indicators">
              <span id="liveIndicator" class="indicator live">Live</span>
              <span id="pauseIndicator" class="indicator paused">Paused</span>
            </div>
          </div>
          <div id="timeElapsedContainer" class="time-elapsed"></div>
          <div id="offline-indicator" class="offline-indicator"><i class="fas fa-signal-slash"></i> I’m currently offline</div>
          <button id="toggleDescriptionButton" class="toggle-description"><i class="fas fa-info-circle"></i> Show Description</button>
          <div id="descriptionModal" class="description-modal"><h2>Description</h2><p id="descriptionModalDescription">Loading description...</p></div>
        </section>
        <aside class="weather-section sleek-aside">
          <img id="weather-icon" alt="Weather Icon" />
          <p id="weather-description"><i class="fas fa-cloud-sun"></i> Loading...</p>
          <p id="temperature"><i class="fas fa-temperature-high"></i> --°C</p>
          <p id="humidity"><i class="fas fa-tint"></i> Humidity: --%</p>
          <p id="wind-speed"><i class="fas fa-wind"></i> Wind: -- m/s</p>
        </aside>
      </div>
      <div id="bufferOverlay" class="buffer-overlay">Buffering...</div>
    </main>
    <footer class="footer">
      <div class="container">
        <p>&copy; 2024 MikuMiku. All rights reserved.</p>
        <button id="manageConsentFooter" class="manage-consent-button"><i class="fas fa-cookie-bite"></i> Manage Cookie Preferences</button>
      </div>
    </footer>
    <div id="consentModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="consentModalTitle" aria-describedby="consentModalDescription">
      <div class="modal-content">
        <button id="closeConsentModal" class="close-button" aria-label="Close Consent Modal"><i class="fas fa-times"></i></button>
        <h2 id="consentModalTitle"><i class="fas fa-cookie"></i> Cookie Consent</h2>
        <p id="consentModalDescription">I use cookies stored in your browser to enhance your experience on my personal website. These cookies are essential for the website's functionality. By clicking "Accept," you consent to their use. You can also manage your cookie preferences in the "Manage Cookie Preferences" section.</p>
        <div class="consent-buttons">
          <button id="acceptConsent" class="consent-button"><i class="fas fa-check"></i> Accept</button>
          <button id="declineConsent" class="consent-button"><i class="fas fa-times"></i> Decline</button>
        </div>
      </div>
    </div>
  </div>
<script>
(() => {
  const q = s => document.querySelector(s);
  const on = (el, ev, fn) => el && el.addEventListener(ev, fn);
  on(window, 'DOMContentLoaded', init);
  function init() {
    q('#pageContainer').classList.add('loaded');
    on(window, 'scroll', () => q('#titleBar').classList.toggle('scrolled', window.scrollY > 50));
    menuToggle(); personToggle(); clockInit(); descToggle(); restoreVideo(); consentInit(); weatherInit(); matrixInit(); socketInit();
  }
  function menuToggle() {
    on(q('#menuButton'),'click',e=>{e.stopPropagation();q('#overlayMenu').classList.add('active');document.body.classList.add('overlay-active');});
    on(q('#closeOverlay'),'click',e=>{e.stopPropagation();q('#overlayMenu').classList.remove('active');document.body.classList.remove('overlay-active');});
    on(window,'click',e=>{if(e.target===q('#overlayMenu')){q('#overlayMenu').classList.remove('active');document.body.classList.remove('overlay-active');}});
  }
  function personToggle() {
    document.querySelectorAll('.personality-button').forEach(btn=>on(btn,'click',()=>{document.documentElement.style.setProperty('--site-color',btn.dataset.color);document.querySelectorAll('.personality-button').forEach(b=>b.classList.remove('active'));btn.classList.add('active');}));
  }
  function clockInit() {
    setInterval(()=>{const now=new Date();q('#local-time').textContent=now.toLocaleTimeString();q('#current-date').textContent=now.toLocaleDateString();q('#day-of-week').textContent=now.toLocaleDateString(undefined,{weekday:'long'});q('#time-zone').textContent='UTC';const hr=now.getHours();q('#greeting-text').textContent=hr<12?'Good Morning!':hr<18?'Good Afternoon!':'Good Evening!';},1000);
  }
  function descToggle() {
    const modal=q('#descriptionModal'), btn=q('#toggleDescriptionButton');
    const showText='<i class="fas fa-info-circle"></i> Show Description', hideText='<i class="fas fa-info-circle"></i> Hide Description';
    if(localStorage.getItem('descriptionModalOpen')==='true'){modal.classList.add('active');btn.innerHTML=hideText;} else {modal.classList.remove('active');btn.innerHTML=showText;}
    on(btn,'click',()=>{const open=modal.classList.toggle('active');btn.innerHTML=open?hideText:showText;localStorage.setItem('descriptionModalOpen',open);});
  }
  function restoreVideo(){const t=localStorage.getItem('currentVideoTitle'),thumb=localStorage.getItem('currentVideoThumbnail');if(t)q('#videoTitle').textContent=t;if(thumb){q('#videoThumbnailImage').src=thumb;q('#videoThumbnailImage').style.display='block';}}
  function consentInit(){const name='cookieConsent',expiry=365,path='/';const modal=q('#consentModal');const setC=v=>document.cookie=`${name}=${v};max-age=${expiry*86400};path=${path};SameSite=Lax${location.protocol==='https:'?';Secure':''}`;const has=()=>document.cookie.includes(name+'=');if(!has())modal.classList.add('active');on(q('#acceptConsent'),'click',()=>{setC(JSON.stringify({necessary:true}));modal.classList.remove('active');});on(q('#declineConsent'),'click',()=>{setC(JSON.stringify({necessary:false}));modal.classList.remove('active');});on(q('#manageConsentFooter'),'click',e=>{e.preventDefault();modal.classList.add('active');});}
  function weatherInit(){async function fw(){try{const r=await fetch('/api/weather?city='+encodeURIComponent('Leeds'));const d=await r.json();if(d.weather){const w=d.weather[0];q('#weather-description').textContent='Condition: '+w.description;q('#temperature').textContent='Temperature: '+Math.round(d.main.temp)+'°C';q('#humidity').textContent='Humidity: '+d.main.humidity+'%';q('#wind-speed').textContent='Wind: '+d.wind.speed+' m/s';q('#weather-icon').src='https://openweathermap.org/img/wn/'+w.icon+'@2x.png';}}}catch(e){console.error(e);} }fw();setInterval(fw,3600000);}  
  function matrixInit(){const canvas=q('#soundWaveCanvas'),ctx=canvas.getContext('2d');let fontSize=20,columns,drops,speeds,phraseCounters,currentDigits;const binary='01',colors=['#00C6FF','#ff4081'],phrases=['Hatsune Miku','The First Sound of the Future','39','Digital Diva','CV01','01'];const resize=()=>{canvas.width=window.innerWidth;canvas.height=window.innerHeight;columns=Math.floor(canvas.width/fontSize);drops=Array(columns).fill(0);speeds=Array.from({length:columns},()=>Math.random()*0.05+0.05);phraseCounters=Array(columns).fill(0);currentDigits=Array(columns).fill('0');};window.addEventListener('resize',resize);resize();(function draw(){ctx.fillStyle='rgba(0,0,0,0.05)';ctx.fillRect(0,0,canvas.width,canvas.height);ctx.font=fontSize+'px monospace';for(let i=0;i<columns;i++){let inc=speeds[i],txt;if(phraseCounters[i]>0){inc=0;phraseCounters[i]--;}if(phraseCounters[i]===0&&Math.random()<0.002){txt=phrases[Math.floor(Math.random()*phrases.length)];ctx.fillStyle='#FF69B4';phraseCounters[i]=180;inc=speeds[i]*0.2;} else {if(Math.random()<0.1)currentDigits[i]=binary.charAt(Math.floor(Math.random()*binary.length));txt=currentDigits[i];ctx.fillStyle=colors[i%colors.length];}const x=i*fontSize,y=drops[i]*fontSize;ctx.fillText(txt,x,y);for(let j=1;j<6;j++){const ty=y-j*fontSize;if(ty<0)break;ctx.fillStyle=`rgba(${parseInt(colors[i%colors.length].slice(1,3),16)},${parseInt(colors[i%colors.length].slice(3,5),16)},${parseInt(colors[i%colors.length].slice(5),16)},${1-j/6})`;ctx.fillText(binary.charAt(Math.floor(Math.random()*binary.length)),x,ty);}if(y>canvas.height&&Math.random()>0.995){drops[i]=0;speeds[i]=Math.random()*0.05+0.05;phraseCounters[i]=0;currentDigits[i]='0';}drops[i]+=inc;}requestAnimationFrame(draw);}());}
  function socketInit(){const socket=io('https://mikumiku.dev');let browsing=false,startTime,interval;const clearOff=()=>{q('#nowPlayingBox').classList.add('offline');q('#offline-indicator').classList.add('visible');interval&&clearInterval(interval);interval=null;browsing=false;};socket.on('connect',()=>socket.emit('requestLatestData'));socket.on('disconnect',clearOff);socket.on('presenceUpdate',d=>{clearOff();if(d.presenceType==='video'){showVideo(d);}else if(d.presenceType==='browsing'){showBrowse(d);}else clearOff();});
  function showVideo(d){browsing=false;interval&&clearInterval(interval);q('#offline-indicator').classList.remove('visible');q('#videoTitle').textContent=d.title;q('#videoThumbnailImage').src=d.thumbnail||'';q('#channelName').textContent=d.channelTitle;q('#viewCount').textContent=Number(d.viewCount).toLocaleString();q('#likeCount').textContent=Number(d.likeCount).toLocaleString();q('#publishedDate').textContent=new Date(d.publishedAt).toLocaleDateString();q('#videoCategory').textContent=d.category;updateProgress(d);}  
  function showBrowse(d){browsing=true;startTime=Date.now();q('#videoTitle').textContent=d.title||'Browsing YouTube';q('#videoThumbnailImage').src='https://www.youtube.com/img/desktop/yt_1200.png';interval=setInterval(()=>{q('#timeElapsedContainer').textContent=new Date(Date.now()-startTime).toISOString().substr(11,8);},1000);}  
  function updateProgress(d){const pct=(d.currentTime/d.duration)*100;q('#progressBar').style.width=pct+'%';q('#liveIndicator').classList.toggle('active',d.isLive);q('#pauseIndicator').classList.toggle('active',d.isPaused);}  
})();
</script>
</body>
</html>
