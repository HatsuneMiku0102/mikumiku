<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Meta Tags and Title -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mm.dev | Home</title>

    <!-- Fonts and Stylesheets -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/styles.css">
</head>

<body>
    <!-- Canvas Background -->
    <canvas id="techCanvas" aria-hidden="true"></canvas>

    <div class="page-container">
        <!-- Title Bar -->
        <header class="title-bar" id="titleBar">
            <div class="container">
                <!-- Left Section: Empty for Alignment -->
                <div class="left-section"></div>

                <!-- Center Section: "mm.dev" Logo and Title -->
                <div class="title-wrapper">
                    <a href="/" aria-label="Home" class="logo-link">
                        <!-- Site Title -->
                        <span class="site-title">mm.dev</span>
                        <!-- The Music Bar SVG Positioned Behind the Title -->
                        <div class="visualizer-wrapper">
                            <!-- Enhanced Visualizer SVG -->
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 100" class="visualizer">
                                <g>
                                    <!-- First bar -->
                                    <rect x="10" y="70" width="15" height="30" fill="#00c6ff">
                                        <animate attributeName="height" values="30;60;30" dur="0.8s" repeatCount="indefinite" />
                                        <animate attributeName="y" values="70;40;70" dur="0.8s" repeatCount="indefinite" />
                                    </rect>

                                    <!-- Second bar -->
                                    <rect x="35" y="60" width="15" height="40" fill="#ff4081">
                                        <animate attributeName="height" values="40;80;40" dur="1s" repeatCount="indefinite" />
                                        <animate attributeName="y" values="60;20;60" dur="1s" repeatCount="indefinite" />
                                    </rect>

                                    <!-- Third bar -->
                                    <rect x="60" y="80" width="15" height="20" fill="#00c6ff">
                                        <animate attributeName="height" values="20;50;20" dur="0.6s" repeatCount="indefinite" />
                                        <animate attributeName="y" values="80;50;80" dur="0.6s" repeatCount="indefinite" />
                                    </rect>

                                    <!-- Fourth bar -->
                                    <rect x="85" y="50" width="15" height="50" fill="#ff4081">
                                        <animate attributeName="height" values="50;90;50" dur="1.2s" repeatCount="indefinite" />
                                        <animate attributeName="y" values="50;10;50" dur="1.2s" repeatCount="indefinite" />
                                    </rect>

                                    <!-- Fifth bar -->
                                    <rect x="110" y="70" width="15" height="30" fill="#00c6ff">
                                        <animate attributeName="height" values="30;60;30" dur="0.9s" repeatCount="indefinite" />
                                        <animate attributeName="y" values="70;40;70" dur="0.9s" repeatCount="indefinite" />
                                    </rect>

                                    <!-- Sixth bar -->
                                    <rect x="135" y="60" width="15" height="40" fill="#ff4081">
                                        <animate attributeName="height" values="40;80;40" dur="1.1s" repeatCount="indefinite" />
                                        <animate attributeName="y" values="60;20;60" dur="1.1s" repeatCount="indefinite" />
                                    </rect>
                                </g>
                            </svg>
                        </div>
                    </a>
                </div>

                <!-- Right Section: Menu Button -->
                <div class="right-section">
                    <button class="menu-button" id="menuButton" aria-label="Open Menu">
                        <!-- Enhanced Musical-themed Menu Icon -->
                        <i class="fas fa-music"></i>
                    </button>
                </div>
            </div>
        </header>
        <!-- End of Title Bar -->

        <!-- Fullscreen Overlay Menu -->
        <nav class="overlay-menu" id="overlayMenu">
            <button class="close-overlay" id="closeOverlay" aria-label="Close Menu">
                <i class="fas fa-times"></i>
            </button>
            <div class="overlay-content">
                <a href="/auth" aria-label="Admin Login"><i class="fas fa-user-lock"></i> Admin Login</a>
                <a href="#aboutMe" aria-label="About Me"><i class="fas fa-info-circle"></i> About Me</a>
                <!-- Personality Options -->
                <div class="personality-options">
                    <button id="personalityOption1" class="personality-button"><i class="fas fa-music"></i> Melody</button>
                    <button id="personalityOption2" class="personality-button"><i class="fas fa-headphones"></i> Harmony</button>
                    <button id="personalityOption3" class="personality-button"><i class="fas fa-microphone"></i> Rhythm</button>
                </div>
            </div>
        </nav>
        <!-- End of Fullscreen Overlay Menu -->

        <!-- Now Playing Section -->
        <section class="now-playing-container">
            <div id="nowPlayingBox" class="now-playing">
                <!-- Channel Info on the Left Side -->
                <aside class="now-playing-sidebar">
                    <div class="sidebar-item">
                        <i class="fas fa-tv"></i> <span>Channel:</span> <span id="channelName">Loading...</span>
                    </div>
                    <div class="sidebar-item">
                        <i class="fas fa-eye"></i> <span>Views:</span> <span id="viewCount">Loading...</span>
                    </div>
                    <div class="sidebar-item">
                        <i class="fas fa-thumbs-up"></i> <span>Likes:</span> <span id="likeCount">Loading...</span>
                    </div>
                    <div class="sidebar-item">
                        <i class="fas fa-calendar-day"></i> <span>Uploaded:</span> <span id="publishedDate">Loading...</span>
                    </div>
                    <div class="sidebar-item video-category">
                        <i class="fas fa-tag"></i> <span>Category:</span> <span id="videoCategory">Loading...</span>
                    </div>

                    <!-- Divider Between Channel Info and Clock -->
                    <hr class="divider">

                    <!-- Clock Section -->
                    <section class="clock-section">
                        <p id="greeting" class="greeting"><i class="fas fa-sun"></i> Good Morning!</p>
                        <div class="clocks-container">
                            <!-- Digital Clock -->
                            <div class="digital-clock">
                                <p id="local-time" class="local-time"><i class="fas fa-clock"></i> --:--:--</p>
                                <p id="current-date" class="current-date"><i class="fas fa-calendar-alt"></i> 24 September 2024</p>
                                <p id="day-of-week" class="day-of-week"><i class="fas fa-calendar-day"></i> Thursday</p>
                                <p id="time-zone" class="time-zone"><i class="fas fa-globe"></i> Time Zone: UTC</p>
                            </div>
                        </div>
                        <p id="last-visit-message" class="last-visit-message"><i class="fas fa-history"></i> Welcome back!</p>
                    </section>
                </aside>

                <!-- End of Channel Info -->

                <!-- Video Section in the Center -->
                <div class="video-section">
                    <div class="video-title-container">
                        <h2>Currently Playing</h2>
                        <p id="videoTitle">Loading...</p>
                    </div>

                    <div class="thumbnail-container">
                        <video id="videoThumbnail" class="video-thumbnail" preload="metadata" controls aria-label="Currently Playing Video">
                            Your browser does not support the video tag.
                        </video>
                        <img id="videoThumbnailImage" src="" alt="Thumbnail" class="video-thumbnail" loading="lazy">
                    </div>

                    <div id="offline-indicator" class="offline-indicator">
                        <i class="fas fa-signal-slash"></i> I’m currently offline
                    </div>

                    <!-- Progress Bar Container -->
                    <div class="progress-bar-container">
                        <div id="progressBar" class="progress-bar"></div>
                    </div>

                    <!-- LIVE Indicator Positioned Below the Progress Bar -->
                    <div class="live-indicator-container">
                        <!-- Live Indicator SVG -->
                        <svg id="liveIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="30" height="30" aria-label="Live Stream Indicator" class="live-icon" role="img" aria-labelledby="liveTitle">
                            <title id="liveTitle">Live Stream Indicator</title>
                            <circle cx="50" cy="50" r="40" fill="#FF0000" opacity="0.9" />
                            <text x="50%" y="55%" text-anchor="middle" fill="#FFFFFF" font-size="12" font-family="Arial, sans-serif" dy=".3em">LIVE</text>
                        </svg>
                    </div>

                    <!-- Time Elapsed Display -->
                    <div id="timeElapsedContainer" class="time-elapsed">
                        <i class="fas fa-clock"></i> <span id="timeElapsed">0s</span>
                    </div>

                    <!-- Show Description Button -->
                    <button class="toggle-description" id="toggleDescriptionButton" aria-label="Toggle Description">
                        <i class="fas fa-info-circle"></i> Show Description
                    </button>

                    <!-- Loading Spinner -->
                    <div id="loadingSpinner" class="loading-spinner" aria-label="Loading">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                </div>
                <!-- End of Video Section -->

                <!-- Divider Between Now Playing and Weather -->
                <hr class="divider">

                <!-- Weather Section on the Right Side -->
                <aside class="weather-section">
                    <img id="weather-icon" src="" alt="Weather Icon" class="weather-icon" loading="lazy">
                    <p id="weather-description" class="weather-description"><i class="fas fa-cloud"></i> Loading...</p>
                    <p id="temperature" class="temperature"><i class="fas fa-thermometer-half"></i> --°C</p>
                    <p id="humidity" class="humidity"><i class="fas fa-tint"></i> Humidity: --%</p>
                    <p id="wind-speed" class="wind-speed"><i class="fas fa-wind"></i> Wind: -- m/s</p>
                </aside>
                <!-- End of Weather Section -->
            </div>
        </section>
        <!-- End of Now Playing Section -->

        <!-- About Section -->
        <section class="content-wrapper">
            <div class="now-playing-about-wrapper">
                <div class="about" id="aboutMe">
                    <h2>About Me</h2>
                    <p>Hey there, I'm Hystoriya, a 24-year-old developer. This is my personal website that I made for no apparent reason. If you find yourself here randomly, then hi :)</p>
                </div>
            </div>
        </section>
        <!-- End of About Section -->

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <p>&copy; 2024 MikuMiku. All rights reserved.</p>
                <button id="manageConsentFooter" class="manage-consent-button"><i class="fas fa-cookie-bite"></i> Manage Cookie Preferences</button>
            </div>
        </footer>
        <!-- End of Footer -->

        <!-- Chat Box -->
        <div id="chat-box" class="chat-box closed" role="dialog" aria-labelledby="chatHeader" aria-modal="true">
            <div class="chat-header">
                <!-- SVG Logo -->
                <div class="chat-logo">
                    <svg width="32" height="32" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <!-- Simple Chat Bubble Icon -->
                        <path d="M10 10 H90 V70 H70 L50 90 L30 70 H10 Z" fill="#ffffff" stroke="#007BFF" stroke-width="5" />
                    </svg>
                </div>
                <h3 id="chatHeader">Haru AI</h3>
                <!-- Close Button with SVG Icon -->
                <button id="close-chat" class="close-chat" aria-label="Close Chat">
                    <svg width="24" height="24" viewBox="0 0 20 20" fill="#ffffff" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 8.586L3.536 2.122 2.122 3.536 8.586 10l-6.464 6.464 1.414 1.414L10 11.414l6.464 6.464 1.414-1.414L11.414 10l6.464-6.464-1.414-1.414L10 8.586z" />
                    </svg>
                </button>
            </div>
            <div id="chat-content" class="chat-content" role="log" aria-live="polite">
                <!-- Example Initial Bot Message -->
                <div class="message bot-message">
                    <div class="message-content">
                        <svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="#007BFF" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10c2.21 0 4.208-.896 5.656-2.344L20 18.414V20h1.586l-1.414-1.414L18.344 17.656C19.792 16.208 20.688 14.21 20.688 12c0-5.514-4.486-10-10-10zm-1 14H7v-2h4v2zm0-4H7v-2h4v2zm6-4h-8v2h8V8z" />
                        </svg>
                        Hi! I'm Haru, how can I help you today?
                    </div>
                </div>
            </div>
            <!-- Loading Spinner -->
            <div id="chat-loading" class="chat-loading" aria-hidden="true">
                <svg class="spinner" width="24" height="24" viewBox="0 0 50 50">
                    <circle class="path" cx="25" cy="25" r="20" fill="none" stroke="#007BFF" stroke-width="5"></circle>
                </svg>
                <span>Thinking...</span>
            </div>
            <div class="chat-input-container">
                <input type="text" id="chat-input" class="chat-input" placeholder="Type your message..." aria-label="Chat Input">
                <button id="send-message" class="send-message" aria-label="Send Message">
                    <!-- Send Icon -->
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="#ffffff" xmlns="http://www.w3.org/2000/svg">
                        <path d="M2.01 21L23 12 2.01 3v7l15 2-15 2z" />
                    </svg>
                </button>
            </div>
        </div>
        <!-- Floating Chat Button -->
        <button id="open-chat" class="open-chat-button" aria-label="Open Chat">
            <!-- Chat Icon -->
            <svg width="24" height="24" viewBox="0 0 24 24" fill="#ffffff" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 2H4C2.897 2 2 2.897 2 4v12c0 1.103.897 2 2 2h5l4 4 4-4h5c1.103 0 2-.897 2-2V4c0-1.103-.897-2-2-2zm0 14l-3-3H5V4h15v12z" />
            </svg>
        </button>
        <!-- End of Floating Chat Button -->

        <!-- Description Modal -->
        <div id="descriptionModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="descriptionModalTitle"
            aria-describedby="descriptionModalDescription">
            <div class="modal-content">
                <button class="close-button" id="closeDescriptionButton" aria-label="Close Description Modal"><i
                        class="fas fa-times"></i></button>
                <h2 id="descriptionModalTitle">Description</h2>
                <p id="descriptionModalDescription">Loading description...</p>
            </div>
        </div>
        <!-- End of Description Modal -->

        <!-- Consent Modal -->
        <div id="consentModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="consentModalTitle"
            aria-describedby="consentModalDescription">
            <div class="modal-content">
                <button class="close-button" id="closeConsentModal" aria-label="Close Consent Modal"><i
                        class="fas fa-times"></i></button>
                <h2 id="consentModalTitle"><i class="fas fa-cookie"></i> Cookie Consent</h2>
                <p id="consentModalDescription">
                    I use cookies stored in your browser to enhance your experience on my personal website. These cookies
                    are essential for the website's functionality. By clicking "Accept," you consent to their use. You can
                    also manage your cookie preferences in the "Manage Cookie Preferences" section.
                </p>
                <div class="consent-buttons">
                    <button id="acceptConsent" class="consent-button"><i class="fas fa-check"></i> Accept</button>
                    <button id="declineConsent" class="consent-button"><i class="fas fa-times"></i> Decline</button>
                </div>
            </div>
        </div>
        <!-- End of Consent Modal -->

        <!-- JavaScript Libraries -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.1/socket.io.min.js" crossorigin="anonymous"
            referrerpolicy="no-referrer"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
        <!-- Import Haru AI script -->
        <script src="haru.js"></script>

        <!-- Tracking Script -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {

                if (window.location.pathname !== '/admin') {

                    fetch('/track', {
                        method: 'POST',
                        credentials: 'include'
                    })
                        .then(response => response.json())
                        .then(data => {
                            console.log('Geolocation data sent successfully:', data);
                        })
                        .catch(error => {
                            console.error('Error sending geolocation data:', error);
                        });
                }
            });
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Function to add animation classes with staggered delays
                function animateElements() {
                    // Title Bar Animation
                    const titleBar = document.getElementById('titleBar');
                    if (titleBar) {
                        setTimeout(() => {
                            titleBar.classList.add('animate-title-bar');
                            console.log('Added animate-title-bar to titleBar');
                        }, 100); // Delay of 100ms
                    } else {
                        console.error('Title Bar element not found!');
                    }
                    // Now Playing Section Animation
                    const nowPlaying = document.querySelector('.now-playing-container');
                    if (nowPlaying) {
                        setTimeout(() => {
                            nowPlaying.classList.add('animate-now-playing');
                            console.log('Added animate-now-playing to nowPlaying');
                        }, 400); // Delay of 400ms
                    } else {
                        console.error('Now Playing container not found!');
                    }

                    // About Me Section Animation
                    const aboutMe = document.querySelector('.about');
                    if (aboutMe) {
                        setTimeout(() => {
                            aboutMe.classList.add('animate-about');
                            console.log('Added animate-about to aboutMe');
                        }, 700); // Delay of 700ms
                    } else {
                        console.error('About Me section not found!');
                    }

                    // Footer Animation
                    const footer = document.querySelector('.footer');
                    if (footer) {
                        setTimeout(() => {
                            footer.classList.add('animate-footer');
                            console.log('Added animate-footer to footer');
                        }, 1000); // Delay of 1000ms
                    } else {
                        console.error('Footer element not found!');
                    }
                }

                animateElements();

                // Title Bar Scroll Effect
                const titleBarElement = document.getElementById('titleBar');
                if (titleBarElement) {
                    window.addEventListener('scroll', () => {
                        if (window.scrollY > 50) {
                            titleBarElement.classList.add('scrolled');
                            console.log('Added scrolled class to titleBar');
                        } else {
                            titleBarElement.classList.remove('scrolled');
                            console.log('Removed scrolled class from titleBar');
                        }
                    });
                } else {
                    console.error('Title Bar element not found for scroll effect!');
                }

                // Overlay Menu Functionality
                const menuButton = document.getElementById('menuButton');
                const overlayMenu = document.getElementById('overlayMenu');
                const closeOverlay = document.getElementById('closeOverlay');

                if (menuButton && overlayMenu) {
                    menuButton.addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent event bubbling
                        overlayMenu.classList.add('active');
                        document.body.classList.add('overlay-active');
                        console.log('Overlay menu activated');
                    });
                } else {
                    console.error('Menu Button or Overlay Menu element not found!');
                }

                if (closeOverlay && overlayMenu) {
                    closeOverlay.addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent event bubbling
                        overlayMenu.classList.remove('active');
                        document.body.classList.remove('overlay-active');
                        console.log('Overlay menu deactivated');
                    });
                } else {
                    console.error('Close Overlay button or Overlay Menu element not found!');
                }

                // Close menu when clicking outside of it
                window.addEventListener('click', (event) => {
                    if (event.target === overlayMenu) {
                        overlayMenu.classList.remove('active');
                        document.body.classList.remove('overlay-active');
                        console.log('Overlay menu closed by clicking outside');
                    }
                });

                // Personality Options Functionality
                const personalityButtons = document.querySelectorAll('.personality-button');
                const siteTitle = document.querySelector('.site-title');

                if (personalityButtons.length > 0 && siteTitle) {
                    personalityButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const personality = button.textContent.trim();
                            changeTitleStyle(personality);
                            setActivePersonalityButton(button);
                        });
                    });
                } else {
                    if (personalityButtons.length === 0) {
                        console.error('No personality buttons found!');
                    }
                    if (!siteTitle) {
                        console.error('Site Title element not found!');
                    }
                }

                function changeTitleStyle(personality) {
                    switch (personality) {
                        case 'Melody':
                            siteTitle.style.color = '#ff4081'; // Example: Change color to secondary
                            console.log('Changed title style to Melody');
                            break;
                        case 'Harmony':
                            siteTitle.style.color = '#00c6ff'; // Example: Change color to primary
                            console.log('Changed title style to Harmony');
                            break;
                        case 'Rhythm':
                            siteTitle.style.color = '#ffffff'; // Example: Change color to white
                            console.log('Changed title style to Rhythm');
                            break;
                        default:
                            siteTitle.style.color = '#00c6ff'; // Default color
                            console.log('Reverted title style to default');
                    }
                }

                function setActivePersonalityButton(activeButton) {
                    personalityButtons.forEach(btn => {
                        btn.classList.remove('active');
                    });
                    activeButton.classList.add('active');
                    console.log(`Active personality button set to ${activeButton.textContent.trim()}`);
                }
            });
        </script>

        <script>
            // [Cookie Consent Script]
            (function () {
                'use strict';

                const CONFIG = {
                    consentCookieName: 'cookieConsent',
                    consentCookieExpiryDays: 365,
                    consentCookiePath: '/',
                    consentModalId: 'consentModal',
                    acceptButtonId: 'acceptConsent',
                    declineButtonId: 'declineConsent',
                    manageButtonIds: ['manageConsentModal', 'manageConsentFooter'],
                    closeButtonId: 'closeConsentModal',
                    cookieCategories: {
                        necessary: {
                            enabled: true,
                            description: 'Necessary cookies enable core functionalities and security features of the website.'
                        }
                    },
                    focusableSelectors: 'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',
                };

                const consentModal = document.getElementById(CONFIG.consentModalId);
                const acceptButton = document.getElementById(CONFIG.acceptButtonId);
                const declineButton = document.getElementById(CONFIG.declineButtonId);
                const closeButton = document.getElementById(CONFIG.closeButtonId);
                const manageConsentButtons = CONFIG.manageButtonIds.map(id => document.getElementById(id));

                function setCookie(name, value, days, path = '/') {
                    let expires = "";
                    if (days) {
                        const date = new Date();
                        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                        expires = "; expires=" + date.toUTCString();
                    }
                    const secure = location.protocol === 'https:' ? "; Secure" : "";
                    const sameSite = "; SameSite=Lax";
                    document.cookie = name + "=" + (value || "") + expires + "; path=" + path + secure + sameSite;
                }

                function getCookie(name) {
                    const nameEQ = name + "=";
                    const ca = document.cookie.split(';');
                    for (let i = 0; i < ca.length; i++) {
                        let c = ca[i];
                        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
                    }
                    return null;
                }

                function eraseCookie(name, path = '/') {
                    document.cookie = name + '=; Max-Age=-99999999; path=' + path + ';';
                }

                function trapFocus(modal) {
                    const focusableElements = modal.querySelectorAll(CONFIG.focusableSelectors);
                    if (focusableElements.length === 0) return;
                    const firstFocusableElement = focusableElements[0];
                    const lastFocusableElement = focusableElements[focusableElements.length - 1];

                    function handleFocus(event) {
                        if (event.key === 'Tab') {
                            if (event.shiftKey) {
                                if (document.activeElement === firstFocusableElement) {
                                    event.preventDefault();
                                    lastFocusableElement.focus();
                                }
                            } else {
                                if (document.activeElement === lastFocusableElement) {
                                    event.preventDefault();
                                    firstFocusableElement.focus();
                                }
                            }
                        }
                        if (event.key === 'Escape') {
                            event.preventDefault();
                        }
                    }

                    modal.addEventListener('keydown', handleFocus);
                }

                function showModal() {
                    consentModal.classList.add('active');
                    document.body.classList.add('modal-active');
                    consentModal.setAttribute('aria-hidden', 'false');

                    const focusableElements = consentModal.querySelectorAll(CONFIG.focusableSelectors);
                    if (focusableElements.length) {
                        focusableElements[0].focus();
                    }

                    trapFocus(consentModal);
                }

                function hideModal() {
                    consentModal.classList.remove('active');
                    document.body.classList.remove('modal-active');
                    consentModal.setAttribute('aria-hidden', 'true');
                }

                function initConsentModal() {
                    const existingConsent = getCookie(CONFIG.consentCookieName);

                    if (!existingConsent) {
                        showModal();
                    } else {
                        applyConsent(existingConsent);
                    }

                    acceptButton.addEventListener('click', function () {
                        setCookie(CONFIG.consentCookieName, JSON.stringify({
                            necessary: true
                        }), CONFIG.consentCookieExpiryDays, CONFIG.consentCookiePath);
                        hideModal();
                        initializeCookies();
                    });

                    declineButton.addEventListener('click', function () {
                        setCookie(CONFIG.consentCookieName, JSON.stringify({
                            necessary: false
                        }), CONFIG.consentCookieExpiryDays, CONFIG.consentCookiePath);
                        hideModal();
                        disableCookies();
                    });

                    manageConsentButtons.forEach(button => {
                        if (button) {
                            button.addEventListener('click', function (event) {
                                event.preventDefault();
                                showModal();
                            });
                        }
                    });

                    closeButton.addEventListener('click', function () {
                        alert('Please make a choice regarding cookie usage.');
                    });

                    window.addEventListener('click', function (event) {
                        if (event.target === consentModal) {
                            alert('Please make a choice regarding cookie usage.');
                        }
                    });
                }

                function applyConsent(consentValue) {
                    try {
                        const consent = JSON.parse(consentValue);
                        if (consent.necessary) {
                            initializeCookies(consent);
                        } else {
                            disableCookies();
                        }
                    } catch (error) {
                        console.error('Error parsing consent cookie:', error);
                        showModal();
                    }
                }

                function initializeCookies(consent) {
                    console.log('Necessary cookies enabled.');
                }

                function disableCookies() {
                    console.log('Necessary cookies disabled.');
                }

                function areCookiesEnabled() {
                    const testCookie = 'test_cookie_consent';
                    setCookie(testCookie, 'test', 1);
                    const result = getCookie(testCookie) === 'test';
                    eraseCookie(testCookie);
                    return result;
                }

                function init() {
                    if (areCookiesEnabled()) {
                        initConsentModal();
                    } else {
                        console.warn('Cookies are disabled in this browser. Consent modal will not be displayed.');
                    }
                }

                document.addEventListener('DOMContentLoaded', init);
            })();
        </script>

        <script>
            // Now Playing Elements and Socket.IO Integration
            const socket = io("https://mikumiku.dev");
            let lastHeartbeatReceived = Date.now();
            let isSessionExpired = false;
            let browsingStartTime = null;
            let browsingInterval = null;

            const nowPlayingBox = document.getElementById("nowPlayingBox");
            const videoTitleElement = document.getElementById("videoTitle");
            const videoThumbnailImage = document.getElementById("videoThumbnailImage");
            const videoThumbnailElement = document.getElementById("videoThumbnail");
            const offlineIndicatorElement = document.getElementById("offline-indicator");
            const progressBarElement = document.getElementById("progressBar");
            const channelNameElement = document.getElementById("channelName");
            const viewCountElement = document.getElementById("viewCount");
            const likeCountElement = document.getElementById("likeCount");
            const publishedDateElement = document.getElementById("publishedDate");
            const videoCategoryElement = document.getElementById("videoCategory");
            const videoDescriptionElement = document.getElementById("descriptionModalDescription");
            const timeElapsedElement = document.getElementById("timeElapsed");
            const liveIconElement = document.getElementById("liveIcon"); // LIVE Indicator

            function formatNumber(number) {
                if (typeof number === 'string') {
                    number = number.replace(/,/g, '');
                }
                const num = Number(number);
                return isNaN(num) ? "N/A" : num.toLocaleString();
            }

            function clearDisplay() {
                nowPlayingBox.classList.add("offline");
                offlineIndicatorElement.style.display = "flex";
                videoTitleElement.textContent = "I’m not on YouTube at the moment, soz :(";
                videoThumbnailImage.src = "";
                videoThumbnailImage.style.display = "none";
                videoThumbnailElement.src = "";
                videoThumbnailElement.style.display = "none";
                channelNameElement.textContent = "";
                viewCountElement.textContent = "";
                likeCountElement.textContent = "";
                publishedDateElement.textContent = "";
                videoCategoryElement.textContent = "";
                progressBarElement.style.width = "0%";
                videoDescriptionElement.textContent = "";
                timeElapsedElement.style.display = "none";
                liveIconElement.style.display = "none"; // Hide LIVE Icon
            }

            function clearVideoPresence() {
                videoTitleElement.textContent = "";
                videoThumbnailImage.src = "";
                videoThumbnailImage.style.display = "none";
                videoThumbnailElement.src = "";
                videoThumbnailElement.style.display = "none";
                channelNameElement.textContent = "";
                viewCountElement.textContent = "";
                likeCountElement.textContent = "";
                publishedDateElement.textContent = "";
                videoCategoryElement.textContent = "";
                progressBarElement.style.width = "0%";
                videoDescriptionElement.textContent = "";
                liveIconElement.style.display = "none"; // Hide LIVE Icon
            }

            function reinitializeSession() {
                console.warn("[Client] Reinitializing session due to mismatch or timeout.");
                clearDisplay();
                isSessionExpired = true;
            }

            function formatTimeElapsed(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const remainingSeconds = seconds % 60;

                if (hours > 0) {
                    return `${hours}h ${minutes}m ${remainingSeconds}s`;
                } else if (minutes > 0) {
                    return `${minutes}m ${remainingSeconds}s`;
                } else {
                    return `${remainingSeconds}s`;
                }
            }

            function displayVideoPresence(data) {
                lastHeartbeatReceived = Date.now();
                nowPlayingBox.classList.remove("offline");
                offlineIndicatorElement.style.display = "none";
            
                videoTitleElement.textContent = data.title || "Unknown Title";
            
                if (data.thumbnail) {
                    videoThumbnailImage.src = data.thumbnail;
                    videoThumbnailImage.style.display = "block";
                    videoThumbnailElement.style.display = "none";
                } else {
                    videoThumbnailImage.src = "";
                    videoThumbnailElement.style.display = "none";
                }
            
                channelNameElement.textContent = data.channelTitle || "Unknown Channel";
                viewCountElement.textContent = `${formatNumber(data.viewCount)}` || "N/A";
                likeCountElement.textContent = `${formatNumber(data.likeCount)}` || "N/A";
            
                if (data.publishedAt) {
                    const publishedDate = new Date(data.publishedAt);
                    publishedDateElement.textContent = ` ${publishedDate.toLocaleDateString()}` || "Published on: N/A";
                } else {
                    publishedDateElement.textContent = "Published on: N/A";
                }
            
                videoCategoryElement.textContent = `${data.category}` || "N/A";
                videoDescriptionElement.textContent = data.description || "No description available.";
                handleRealTimeProgress(data);
                timeElapsedElement.style.display = "none";
            
                if (data.videoSrc) {
                    videoThumbnailElement.src = data.videoSrc;
                    videoThumbnailElement.style.display = "block";
                    videoThumbnailImage.style.display = "none";
                } else {
                    videoThumbnailElement.style.display = "none";
                    videoThumbnailImage.style.display = "block";
                }
            
                // Handle Live Status
                if (data.isLive) {
                    liveIconElement.classList.add('active'); // Add active class to trigger animation
                    liveIconElement.style.display = "flex"; // Use 'flex' to utilize CSS flex properties
                } else {
                    liveIconElement.classList.remove('active'); // Remove active class
                    liveIconElement.style.display = "none"; // Hide the live icon when not live
                }
            }


            function handleRealTimeProgress(data) {
                if (data.duration && data.currentTime) {
                    const progressPercentage = (data.currentTime / data.duration) * 100;
                    progressBarElement.style.width = `${progressPercentage}%`;
                } else {
                    progressBarElement.style.width = "0%";
                }
            }

            function displayBrowsingPresence(data) {
                lastHeartbeatReceived = Date.now();
                nowPlayingBox.classList.remove("offline");
                offlineIndicatorElement.style.display = "none";

                clearVideoPresence();

                videoTitleElement.textContent = data.title || "Browsing YouTube";
                videoThumbnailImage.src = data.thumbnail || "";
                videoThumbnailImage.style.display = "block";
                videoThumbnailElement.style.display = "none";
                channelNameElement.textContent = "Browsing...";
                videoDescriptionElement.textContent = data.description || "Browsing videos on YouTube";
                progressBarElement.style.width = "0%";

                if (data.timeElapsed !== undefined) {
                    timeElapsedElement.textContent = `Time Elapsed: ${formatTimeElapsed(data.timeElapsed)}`;
                    timeElapsedElement.style.display = "block";
                }
            }

            function updateBrowsingPresence() {
                if (browsingStartTime !== null) {
                    const timeElapsed = Math.floor((Date.now() - browsingStartTime) / 1000);
                    timeElapsedElement.textContent = `Time Elapsed: ${formatTimeElapsed(timeElapsed)}`;
                    timeElapsedElement.style.display = "block";

                    const browsingData = {
                        title: 'YouTube',
                        description: 'Browsing videos',
                        thumbnail: '',
                        timeElapsed: timeElapsed,
                        presenceType: 'browsing'
                    };
                    socket.emit('updateBrowsingPresence', browsingData);
                }
            }

            function startBrowsingPresence() {
                if (browsingStartTime === null) {
                    browsingStartTime = Date.now();
                }
                if (!browsingInterval) {
                    browsingInterval = setInterval(updateBrowsingPresence, 5000);
                }
            }

            function stopBrowsingPresence() {
                if (browsingInterval) {
                    clearInterval(browsingInterval);
                    browsingInterval = null;
                }
                browsingStartTime = null;
            }

            socket.on("connect", () => {
                console.log("[Socket.IO] Connected to server.");
                isSessionExpired = false;
                socket.emit('requestLatestData');
            });

            socket.on("presenceUpdate", (data) => {
                if (isSessionExpired) {
                    console.warn("[Client] Ignoring presenceUpdate due to expired session.");
                    return;
                }

                console.log("[Socket.IO] Received presenceUpdate:", data);

                if (data.presenceType === 'video') {
                    stopBrowsingPresence();
                    displayVideoPresence(data);
                } else if (data.presenceType === 'browsing') {
                    displayBrowsingPresence(data);
                    startBrowsingPresence();
                } else {
                    clearDisplay();
                }
            });

            socket.on("reinitializeSession", (data) => {
                console.warn(`[Socket.IO] Received reinitializeSession: ${JSON.stringify(data)}`);
                reinitializeSession();
            });

            socket.on("sessionExpired", (data) => {
                console.warn(`[Socket.IO] Session expired for video ID: ${data.videoId}`);
                reinitializeSession();
            });

            socket.on("disconnect", () => {
                console.warn("[Socket.IO] Disconnected from server.");
                stopBrowsingPresence();
                clearDisplay();
            });

            setInterval(() => {
                if (Date.now() - lastHeartbeatReceived > 60000) {
                    console.warn("[Heartbeat] No heartbeat received in the last 60 seconds. Marking as offline.");
                    clearDisplay();
                }
            }, 5000);

            // Modal Toggle Logic
            const descriptionModal = document.getElementById("descriptionModal");
            const closeDescriptionButton = document.getElementById("closeDescriptionButton");
            const toggleDescriptionButton = document.getElementById("toggleDescriptionButton");

            toggleDescriptionButton.addEventListener("click", function () {
                if (descriptionModal.classList.contains("active")) {
                    descriptionModal.classList.remove("active");
                    toggleDescriptionButton.innerHTML = '<i class="fas fa-info-circle"></i> Show Description';
                } else {
                    descriptionModal.classList.add("active");
                    toggleDescriptionButton.innerHTML = '<i class="fas fa-info-circle"></i> Hide Description';
                }
            });

            closeDescriptionButton.addEventListener("click", function () {
                descriptionModal.classList.remove("active");
                toggleDescriptionButton.innerHTML = '<i class="fas fa-info-circle"></i> Show Description';
            });

            window.addEventListener("click", function (event) {
                if (event.target === descriptionModal) {
                    descriptionModal.classList.remove("active");
                    toggleDescriptionButton.innerHTML = '<i class="fas fa-info-circle"></i> Show Description';
                }
            });


            // Clock Update Script
            function updateClocks() {
                const now = new Date();
                const localTime = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                const localTimeElement = document.getElementById('local-time');
                if (localTimeElement) localTimeElement.textContent = ` <i class="fas fa-clock"></i> ${localTime}`;
                const currentDate = now.toLocaleDateString(undefined, { day: '2-digit', month: 'long', year: 'numeric' });
                const currentDateElement = document.getElementById('current-date');
                if (currentDateElement) currentDateElement.textContent = ` <i class="fas fa-calendar-alt"></i> ${currentDate}`;
                const dayOfWeek = now.toLocaleDateString(undefined, { weekday: 'long' });
                const dayOfWeekElement = document.getElementById('day-of-week');
                if (dayOfWeekElement) dayOfWeekElement.textContent = ` <i class="fas fa-calendar-day"></i> ${dayOfWeek}`;
            }

            setInterval(updateClocks, 1000);
            updateClocks();

            // Weather Update Script
            const CITY_NAME = 'Leeds';
            async function fetchWeather() {
                try {
                    const response = await fetch(`/api/weather?city=${encodeURIComponent(CITY_NAME)}`);
                    const data = await response.json();

                    if (data.error) {
                        throw new Error(data.error);
                    }

                    displayWeather(data);
                } catch (error) {
                    console.error('Error fetching weather data:', error);
                    const weatherIconElement = document.getElementById('weather-icon');
                    if (weatherIconElement) weatherIconElement.style.display = 'none';
                    document.getElementById('weather-description').innerText = 'Unable to fetch weather data.';
                }
            }

            function displayWeather(data) {
                const description = data.weather[0].description;
                const temperature = Math.round(data.main.temp);
                const humidity = data.main.humidity;
                const windSpeed = data.wind.speed;
                const iconCode = data.weather[0].icon;
                const iconUrl = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;

                document.getElementById('weather-description').innerText = `Condition: ${description}`;
                document.getElementById('temperature').innerText = `Temperature: ${temperature}°C`;
                document.getElementById('humidity').innerText = `Humidity: ${humidity}%`;
                document.getElementById('wind-speed').innerText = `Wind: ${windSpeed} m/s`;

                const weatherIconElement = document.getElementById('weather-icon');
                if (weatherIconElement) {
                    weatherIconElement.src = iconUrl;
                    weatherIconElement.style.display = 'block';
                }
            }

            setInterval(fetchWeather, 3600000); // Update every hour
            fetchWeather();
        </script>

        <script>
            // Canvas Animation Script
            document.addEventListener('DOMContentLoaded', function () {
                const canvas = document.getElementById('techCanvas');
                const ctx = canvas.getContext('2d');
                let particlesArray = [];
                const numberOfParticles = 100;

                // Set canvas size
                function resizeCanvas() {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                }

                window.addEventListener('resize', resizeCanvas);
                resizeCanvas();

                // Particle Class
                class Particle {
                    constructor() {
                        this.x = Math.random() * canvas.width;
                        this.y = canvas.height + Math.random() * canvas.height;
                        this.size = Math.random() * 2 + 1;
                        this.speed = Math.random() * 1 + 0.5;
                        this.angle = Math.random() * Math.PI * 2;
                        this.alpha = Math.random() * 0.5 + 0.3;
                        this.color = `rgba(0, 198, 255, ${this.alpha})`;
                    }

                    update() {
                        this.y -= this.speed;
                        this.x += Math.sin(this.angle) * 0.5;
                        // Reset particle when it moves off the top
                        if (this.y < -this.size) {
                            this.y = canvas.height + this.size;
                            this.x = Math.random() * canvas.width;
                        }
                    }

                    draw() {
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2, false);
                        ctx.fillStyle = this.color;
                        ctx.fill();
                    }
                }

                // Initialize Particles
                function init() {
                    particlesArray = [];
                    for (let i = 0; i < numberOfParticles; i++) {
                        particlesArray.push(new Particle());
                    }
                }

                init();

                // Animate Particles
                function animate() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    for (let particle of particlesArray) {
                        particle.update();
                        particle.draw();
                    }
                    requestAnimationFrame(animate);
                }

                animate();

                // Optional: Adjust particle count based on screen size
                window.addEventListener('resize', () => {
                    if (window.innerWidth < 600) {
                        particlesArray.length = 50;
                    } else {
                        particlesArray.length = 100;
                    }
                });

                // ==================================================
                // Animations using Anime.js
                // ==================================================

                // Animate Now Playing Box
                anime({
                    targets: '#nowPlayingBox',
                    translateY: [-50, 0],
                    opacity: [0, 1],
                    duration: 1000,
                    easing: 'easeOutExpo'
                });

                // Animate Widgets (Clock, Weather, etc.)
                anime({
                    targets: ['.now-playing-sidebar', '.video-section', '.weather-section'],
                    translateX: [-100, 0],
                    opacity: [0, 1],
                    delay: anime.stagger(200),
                    duration: 1000,
                    easing: 'easeOutExpo'
                });

                // Animate Footer
                anime({
                    targets: '.footer',
                    translateY: [50, 0],
                    opacity: [0, 1],
                    duration: 1000,
                    easing: 'easeOutExpo'
                });
            });
        </script>
    </div>
</body>

</html>
