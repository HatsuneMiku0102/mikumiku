<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Miku.dev | Home</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <canvas id="soundWaveCanvas" aria-hidden="true"></canvas>
  <div class="page-container" id="pageContainer">
    <header class="title-bar" id="titleBar">
      <div class="container">
        <div class="left-section"></div>
        <div class="title-wrapper">
          <a href="/" aria-label="Home" class="logo-link">
            <span class="site-title">Miku.dev</span>
            <div class="visualizer-wrapper">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 100" class="visualizer">
                <g>
                  <rect x="10" y="70" width="15" height="30" fill="#00c6ff">
                    <animate attributeName="height" values="30;60;30" dur="0.8s" repeatCount="indefinite" />
                    <animate attributeName="y" values="70;40;70" dur="0.8s" repeatCount="indefinite" />
                  </rect>
                  <rect x="35" y="60" width="15" height="40" fill="#ff4081">
                    <animate attributeName="height" values="40;80;40" dur="1s" repeatCount="indefinite" />
                    <animate attributeName="y" values="60;20;60" dur="1s" repeatCount="indefinite" />
                  </rect>
                  <rect x="60" y="80" width="15" height="20" fill="#00c6ff">
                    <animate attributeName="height" values="20;50;20" dur="0.6s" repeatCount="indefinite" />
                    <animate attributeName="y" values="80;50;80" dur="0.6s" repeatCount="indefinite" />
                  </rect>
                  <rect x="85" y="50" width="15" height="50" fill="#ff4081">
                    <animate attributeName="height" values="50;90;50" dur="1.2s" repeatCount="indefinite" />
                    <animate attributeName="y" values="50;10;50" dur="1.2s" repeatCount="indefinite" />
                  </rect>
                  <rect x="110" y="70" width="15" height="30" fill="#00c6ff">
                    <animate attributeName="height" values="30;60;30" dur="0.9s" repeatCount="indefinite" />
                    <animate attributeName="y" values="70;40;70" dur="0.9s" repeatCount="indefinite" />
                  </rect>
                  <rect x="135" y="60" width="15" height="40" fill="#ff4081">
                    <animate attributeName="height" values="40;80;40" dur="1.1s" repeatCount="indefinite" />
                    <animate attributeName="y" values="60;20;60" dur="1.1s" repeatCount="indefinite" />
                  </rect>
                </g>
              </svg>
            </div>
          </a>
        </div>
        <div class="right-section">
          <button class="menu-button" id="menuButton" aria-label="Open Menu"><i class="fas fa-music"></i></button>
        </div>
      </div>
    </header>

    <nav class="overlay-menu" id="overlayMenu">
      <button class="close-overlay" id="closeOverlay" aria-label="Close Menu"><i class="fas fa-times"></i></button>
      <div class="overlay-content">
        <a href="/auth" aria-label="Admin Login"><i class="fas fa-user-lock"></i> Admin Login</a>
        <a href="#aboutMe" aria-label="About Me"><i class="fas fa-info-circle"></i> About Me</a>
        <div class="personality-options">
          <button data-color="#ff4081" class="personality-button"><i class="fas fa-music"></i> Melody</button>
          <button data-color="#00c6ff" class="personality-button"><i class="fas fa-headphones"></i> Harmony</button>
          <button data-color="#ffffff" class="personality-button"><i class="fas fa-microphone"></i> Rhythm</button>
        </div>
      </div>
    </nav>

    <section class="now-playing-container">
      <div id="nowPlayingBox" class="grid-container">
        <!-- Video Info -->
        <div id="videoInfo" class="video-info-details">
          <div class="info-item"><i class="fas fa-tv"></i> <span id="channelName"></span></div>
          <div class="info-item"><i class="fas fa-eye"></i> <span id="viewCount"></span></div>
          <div class="info-item"><i class="fas fa-thumbs-up"></i> <span id="likeCount"></span></div>
          <div class="info-item"><i class="fas fa-calendar-day"></i> <span id="publishedDate"></span></div>
          <div class="info-item video-category"><i class="fas fa-tag"></i> <span id="videoCategory"></span></div>
        </div>
        <!-- Clock -->
        <div id="timeInfo">
          <section class="clock-section">
            <p id="greeting"><i class="fas fa-sun"></i> <span id="greeting-text"></span></p>
            <div class="digital-clock">
              <p id="local-time"><i class="fas fa-clock"></i></p>
              <p id="current-date"><i class="fas fa-calendar-alt"></i></p>
              <p id="day-of-week"><i class="fas fa-calendar-day"></i></p>
              <p id="time-zone"><i class="fas fa-globe"></i> UTC</p>
            </div>
            <p id="last-visit-message"><i class="fas fa-history"></i> Welcome back!</p>
          </section>
        </div>
        <!-- YouTube Section -->
        <div id="youtubeSection">
          <div class="video-title-container">
            <h2>Currently Playing</h2>
            <p id="videoTitle"></p>
          </div>
          <div class="thumbnail-container">
            <img id="videoThumbnailImage" class="video-thumbnail" alt="Thumbnail" loading="lazy" />
          </div>
          <div class="progress-container">
            <div class="progress-bar-container"><div id="progressBar" class="progress-bar"></div></div>
            <div class="indicator-container">
              <span id="liveIndicator" class="indicator live"></span>
              <span id="pauseIndicator" class="indicator paused"></span>
            </div>
            <div id="timeElapsedContainer" class="time-elapsed"></div>
          </div>
          <div id="offline-indicator" class="offline-indicator"><i class="fas fa-signal-slash"></i> I’m offline</div>
          <button id="toggleDescriptionButton" class="toggle-description"><i class="fas fa-info-circle"></i> Show Description</button>
          <div id="descriptionModal" class="description-modal"><h2>Description</h2><p id="descriptionModalDescription"></p></div>
        </div>
        <!-- Weather -->
        <aside class="weather-section">
          <img id="weather-icon" class="weather-icon" alt="Weather Icon" loading="lazy" />
          <p id="weather-description" class="weather-description"></p>
          <p id="temperature" class="temperature"></p>
          <p id="humidity" class="humidity"></p>
          <p id="wind-speed" class="wind-speed"></p>
        </aside>
      </div>
      <div id="bufferOverlay" class="buffer-overlay">Buffering...</div>
    </section>

    <footer class="footer">
      <div class="container">
        <p>&copy; 2024 MikuMiku. All rights reserved.</p>
        <button id="manageConsentFooter" class="manage-consent-button"><i class="fas fa-cookie-bite"></i> Manage Cookie Preferences</button>
      </div>
    </footer>
  </div>

  <div id="consentModal" class="modal" aria-hidden="true" role="dialog">
    <div class="modal-content">
      <button id="closeConsentModal" class="close-button" aria-label="Close Consent Modal"><i class="fas fa-times"></i></button>
      <h2><i class="fas fa-cookie"></i> Cookie Consent</h2>
      <p>I use cookies to enhance your experience. By clicking "Accept," you consent. Manage preferences anytime.</p>
      <div class="consent-buttons">
        <button id="acceptConsent" class="consent-button"><i class="fas fa-check"></i> Accept</button>
        <button id="declineConsent" class="consent-button"><i class="fas fa-times"></i> Decline</button>
      </div>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const byId = id => document.getElementById(id);
    const toggleClass = (el, cls, cond) => el?.classList.toggle(cls, cond);
    // Page Load & Scroll
    byId('pageContainer')?.classList.add('loaded');
    const titleBar = byId('titleBar');
    window.addEventListener('scroll', () => toggleClass(titleBar, 'scrolled', window.scrollY > 50));
    // Menu Overlay
    const overlay = byId('overlayMenu');
    byId('menuButton')?.addEventListener('click', e => { e.stopPropagation(); overlay.classList.add('active'); document.body.classList.add('overlay-active'); });
    byId('closeOverlay')?.addEventListener('click', e => { e.stopPropagation(); overlay.classList.remove('active'); document.body.classList.remove('overlay-active'); });
    window.addEventListener('click', e => { if (e.target === overlay) overlay.click(); });
    // Personality
    document.querySelectorAll('.personality-button').forEach(btn =>
      btn.addEventListener('click', () => {
        document.querySelectorAll('.personality-button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        document.querySelector('.site-title').style.color = btn.dataset.color;
      })
    );
    // Clock
    const updateClocks = () => {
      const now = new Date();
      byId('local-time').textContent = ' ' + now.toLocaleTimeString();
      byId('current-date').textContent = ' ' + now.toLocaleDateString(undefined, {day:'2-digit',month:'long',year:'numeric'});
      byId('day-of-week').textContent = ' ' + now.toLocaleDateString(undefined, {weekday:'long'});
      byId('greeting-text').textContent = now.getHours()<12?'Good Morning!':now.getHours()<18?'Good Afternoon!':'Good Evening!';
    };
    setInterval(updateClocks,1000); updateClocks();
    // Consent
    (function(){
      const name='cookieConsent', expiry=365, path='/';
      const setCookie=(n,v,d)=>{const dt=new Date();dt.setTime(dt.getTime()+d*864e5);document.cookie=`${n}=${v};expires=${dt.toUTCString()};path=${path};SameSite=Lax${location.protocol==='https:'?';Secure':''}`};
      const getCookie=n=>document.cookie.split('; ').find(r=>r.startsWith(n+'='))?.split('=')[1];
      const showModal=()=>{byId('consentModal').classList.add('active');document.body.classList.add('modal-active');};
      const hideModal=()=>{byId('consentModal').classList.remove('active');document.body.classList.remove('modal-active');};
      const init = () => { if(!getCookie(name)) showModal(); else hideModal(); };
      byId('acceptConsent')?.addEventListener('click',()=>{setCookie(name,true,expiry);hideModal();});
      byId('declineConsent')?.addEventListener('click',()=>{setCookie(name,false,expiry);hideModal();});
      byId('manageConsentFooter')?.addEventListener('click',e=>{e.preventDefault();showModal();});
      byId('closeConsentModal')?.addEventListener('click',()=>alert('Please choose cookie preference.'));
      init();
    })();
    // Weather
    const fetchWeather = async () => {
      try {
        const res = await fetch('/api/weather?city=' + encodeURIComponent('Leeds'));
        const data = await res.json();
        if (data.weather) {
          const w=data.weather[0];
          byId('weather-description').textContent = 'Condition: ' + w.description;
          byId('temperature').textContent = 'Temperature: ' + Math.round(data.main.temp) + '°C';
          byId('humidity').textContent = 'Humidity: ' + data.main.humidity + '%';
          byId('wind-speed').textContent = 'Wind: ' + data.wind.speed + ' m/s';
          const icon=byId('weather-icon'); icon.src = 'https://openweathermap.org/img/wn/'+w.icon+'@2x.png'; icon.style.display='block';
        }
      } catch(e) { byId('weather-description').innerText='Unable to fetch weather.'; }
    };
    fetchWeather(); setInterval(fetchWeather,3600000);
    // Sound Matrix Effect
    (function(){
      const canvas=byId('soundWaveCanvas'), ctx=canvas.getContext('2d');
      const fontSize=20; let cols, drops, speeds, counters, digits;
      const resize=()=>{canvas.width=innerWidth;canvas.height=innerHeight; cols=Math.floor(canvas.width/fontSize); drops=Array(cols).fill(0); speeds=Array.from({length:cols},()=>Math.random()*0.05+0.05); counters=Array(cols).fill(0); digits=Array(cols).fill('0');};
      window.addEventListener('resize',resize); resize();
      const chars='01', colors=['#00C6FF','#ff4081'], phrases=['Hatsune Miku','The First Sound of the Future','39','Digital Diva','CV01','01'];
      function draw(){ ctx.fillStyle='rgba(0,0,0,0.05)';ctx.fillRect(0,0,canvas.width,canvas.height);ctx.font=fontSize+'px monospace';
        drops.forEach((d,i)=>{ let txt,inc=speeds[i]; if(counters[i]>0){ inc=0; counters[i]--; }
          if(counters[i]===0 && Math.random()<0.002){ txt=phrases[Math.floor(Math.random()*phrases.length)]; ctx.fillStyle='#FF69B4'; counters[i]=180; inc=speeds[i]*0.2; }
          else { if(Math.random()<0.1) digits[i]=chars.charAt(Math.floor(Math.random()*chars.length)); txt=digits[i]; ctx.fillStyle=colors[i%colors.length]; }
          const x=i*fontSize,y=Math.floor(d)*fontSize; ctx.fillText(txt,x,y);
          for(let j=1;j<6;j++){ const ty=y-j*fontSize; if(ty<0) break; ctx.fillStyle=`rgba(${parseInt(colors[i%2].slice(1,3),16)},${parseInt(colors[i%2].slice(3,5),16)},${parseInt(colors[i%2].slice(5),16)},${1-j/6})`; ctx.fillText(chars.charAt(Math.floor(Math.random()*chars.length)),x,ty); }
          if(y>canvas.height && Math.random()>0.995){ drops[i]=0; speeds[i]=Math.random()*0.05+0.05; counters[i]=0; digits[i]='0'; }
          drops[i]+=inc;
        });
        requestAnimationFrame(draw);
      }
      draw();
    })();
  });
  </script>
</body>
</html>
