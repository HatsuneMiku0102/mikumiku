<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Miku.dev | Home</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer"/>
  <link rel="stylesheet" href="/styles.css"/>
  <style>
    .status-box { position: relative; }
    .status-box.live.active::before { left: 50%; }
    .weather-ambient { display: none; }
  </style>
</head>
<body>
  <canvas id="soundWaveCanvas" aria-hidden="true"></canvas>
  <div class="weather-ambient" aria-hidden="true">
    <div class="ambient-layer" id="ambientLayer"></div>
  </div>
  <div class="idle-overlay" id="idleOverlay">
    <div class="idle-orbs" id="idleOrbs"></div>
  </div>
  <div class="konami" id="konamiBox">ミクはいつもここにいるよ ♪</div>

  <div class="page-container" id="pageContainer">
    <header class="title-bar" id="titleBar">
      <div class="container">
        <div class="left-section"></div>
        <div class="title-wrapper">
          <a href="/" aria-label="Home" class="logo-link">
            <span class="site-title">Miku.dev</span>
            <div class="visualizer-wrapper">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 100" class="visualizer">
                <g>
                  <rect x="10" y="70" width="15" height="30" fill="#00c6ff">
                    <animate attributeName="height" values="30;60;30" dur="0.8s" repeatCount="indefinite"/>
                    <animate attributeName="y" values="70;40;70" dur="0.8s" repeatCount="indefinite"/>
                  </rect>
                  <rect x="35" y="60" width="15" height="40" fill="#ff4081">
                    <animate attributeName="height" values="40;80;40" dur="1s" repeatCount="indefinite"/>
                    <animate attributeName="y" values="60;20;60" dur="1s" repeatCount="indefinite"/>
                  </rect>
                  <rect x="60" y="80" width="15" height="20" fill="#00c6ff">
                    <animate attributeName="height" values="20;50;20" dur="0.6s" repeatCount="indefinite"/>
                    <animate attributeName="y" values="80;50;80" dur="0.6s" repeatCount="indefinite"/>
                  </rect>
                  <rect x="85" y="50" width="15" height="50" fill="#ff4081">
                    <animate attributeName="height" values="50;90;50" dur="1.2s" repeatCount="indefinite"/>
                    <animate attributeName="y" values="50;10;50" dur="1.2s" repeatCount="indefinite"/>
                  </rect>
                  <rect x="110" y="70" width="15" height="30" fill="#00c6ff">
                    <animate attributeName="height" values="30;60;30" dur="0.9s" repeatCount="indefinite"/>
                    <animate attributeName="y" values="70;40;70" dur="0.9s" repeatCount="indefinite"/>
                  </rect>
                  <rect x="135" y="60" width="15" height="40" fill="#ff4081">
                    <animate attributeName="height" values="40;80;40" dur="1.1s" repeatCount="indefinite"/>
                    <animate attributeName="y" values="60;20;60" dur="1.1s" repeatCount="indefinite"/>
                  </rect>
                </g>
              </svg>
            </div>
          </a>
        </div>
        <div class="right-section">
          <button class="menu-button" id="menuButton" aria-label="Open Menu">
            <i class="fas fa-music"></i>
          </button>
        </div>
      </div>
    </header>

    <nav class="overlay-menu" id="overlayMenu">
      <button class="close-overlay" id="closeOverlay" aria-label="Close Menu">
        <i class="fas fa-times"></i>
      </button>
      <div class="overlay-content">
        <a href="/auth" aria-label="Admin Login"><i class="fas fa-user-lock"></i> Admin Login</a>
        <a href="#aboutMe" aria-label="About Me"><i class="fas fa-info-circle"></i> About Me</a>
        <div class="personality-options">
          <button id="personalityOption1" class="personality-button"><i class="fas fa-music"></i> Melody</button>
          <button id="personalityOption2" class="personality-button"><i class="fas fa-headphones"></i> Harmony</button>
          <button id="personalityOption3" class="personality-button"><i class="fas fa-microphone"></i> Rhythm</button>
        </div>
      </div>
    </nav>

    <section class="now-playing-container">
      <div class="now-playing-card" id="nowPlayingCard">
        <div class="now-playing-grid">
          <div class="video-info">
            <div class="info-item"><i class="fas fa-tv"></i><span id="channelName">Loading…</span></div>
            <div class="info-item"><i class="fas fa-eye"></i><span id="viewCount">Loading…</span></div>
            <div class="info-item"><i class="fas fa-thumbs-up"></i><span id="likeCount">Loading…</span></div>
            <div class="info-item"><i class="fas fa-calendar-day"></i><span id="publishedDate">Loading…</span></div>
            <div class="info-item"><i class="fas fa-tag"></i><span id="videoCategory">Loading…</span></div>
          </div>

          <div class="time-info">
            <div class="greeting-container">
              <p class="greeting"><i class="fas fa-sun"></i> <span id="greeting-text">Good Morning!</span></p>
            </div>
            <div class="clock-container">
              <div class="digital-clock">
                <p id="local-time"><i class="fas fa-clock"></i> 00:00:00</p>
                <p id="current-date"><i class="fas fa-calendar-alt"></i> 1 January 2025</p>
                <p id="day-of-week"><i class="fas fa-calendar-day"></i> Wednesday</p>
                <p id="time-zone"><i class="fas fa-globe"></i> UTC</p>
              </div>
            </div>
          </div>

          <div class="youtube-section" id="youtubeSection">
            <div class="video-thumb">
              <img id="videoThumbnailImage" class="thumb-img" src="" alt="Thumbnail" loading="lazy"/>
            </div>
            <div class="video-details">
              <h3>Currently Playing</h3>
              <p id="videoTitle">Loading…</p>
              <button id="toggleDescriptionButton"><i class="fas fa-info-circle"></i> Show Description</button>
            </div>
          </div>

          <aside class="weather-info">
            <img id="weather-icon" src="" alt="Weather Icon" loading="lazy"/>
            <p id="weather-description">Loading…</p>
            <p id="temperature">--°C</p>
            <p id="humidity">Humidity: --%</p>
            <p id="wind-speed">Wind: -- m/s</p>
          </aside>
        </div>
      </div>
    </section>

    <footer class="footer">
      <div class="container">
        <p>&copy; 2024 MikuMiku. All rights reserved.</p>
        <button id="manageConsentFooter" class="manage-consent-button"><i class="fas fa-cookie-bite"></i> Manage Cookie Preferences</button>
      </div>
    </footer>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.1/socket.io.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const pageContainer = document.getElementById("pageContainer");
      pageContainer.classList.add("loaded");

      const titleBar = document.getElementById("titleBar");
      window.addEventListener("scroll", () => titleBar.classList.toggle("scrolled", window.scrollY > 50));

      const overlayMenu = document.getElementById("overlayMenu");
      const menuButton = document.getElementById("menuButton");
      const closeOverlay = document.getElementById("closeOverlay");

      menuButton.addEventListener("click", e => {
        e.stopPropagation();
        overlayMenu.classList.add("active");
        document.body.classList.add("overlay-active");
      });
      closeOverlay.addEventListener("click", e => {
        e.stopPropagation();
        overlayMenu.classList.remove("active");
        document.body.classList.remove("overlay-active");
      });
      window.addEventListener("click", e => {
        if(e.target === overlayMenu) {
          overlayMenu.classList.remove("active");
          document.body.classList.remove("overlay-active");
        }
      });

      const personalityButtons = document.querySelectorAll(".personality-button");
      const siteTitle = document.querySelector(".site-title");
      personalityButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const val = btn.textContent.trim();
          siteTitle.style.color = val === "Melody" ? "#ff4081" : val === "Harmony" ? "#00c6ff" : "#ffffff";
          personalityButtons.forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
        });
      });

      function updateClock() {
        const d = new Date();
        document.getElementById("local-time").textContent = d.toLocaleTimeString();
        document.getElementById("current-date").textContent = d.toLocaleDateString(undefined, { day:"2-digit", month:"long", year:"numeric" });
        document.getElementById("day-of-week").textContent = d.toLocaleDateString(undefined, { weekday:"long" });
      }
      setInterval(updateClock, 1000);
      updateClock();

      function updateWeatherUI(data) {
        document.getElementById('weather-icon').src = `https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`;
        document.getElementById('weather-description').textContent = `Condition: ${data.weather[0].description}`;
        document.getElementById('temperature').textContent = `Temperature: ${Math.round(data.main.temp)}°C`;
        document.getElementById('humidity').textContent = `Humidity: ${data.main.humidity}%`;
        document.getElementById('wind-speed').textContent = `Wind: ${data.wind.speed} m/s`;
      }

      async function fetchWeather(city='Leeds') {
        try {
          const res = await fetch(`/api/weather?city=${encodeURIComponent(city)}`);
          if(!res.ok) throw new Error(`HTTP ${res.status}`);
          const data = await res.json();
          updateWeatherUI(data);
        } catch(err) {
          console.error(err);
          document.getElementById('weather-description').textContent = 'Unable to fetch weather data.';
        }
      }
      fetchWeather();
      setInterval(fetchWeather, 3600000);

      const toggleDescriptionBtn = document.getElementById("toggleDescriptionButton");
      const descModal = document.getElementById("descriptionModal");
      const backdrop = document.getElementById("backdrop");
      function openDesc() { descModal?.classList.add("active"); backdrop?.classList.add("active"); document.body.classList.add("modal-open"); }
      function closeDesc() { descModal?.classList.remove("active"); backdrop?.classList.remove("active"); document.body.classList.remove("modal-open"); }
      toggleDescriptionBtn?.addEventListener("click", () => descModal?.classList.contains("active") ? closeDesc() : openDesc());
      backdrop?.addEventListener("click", closeDesc);
      document.addEventListener("keydown", e => { if(e.key === "Escape") closeDesc(); });
    });
  </script>


  <script>
    document.addEventListener("DOMContentLoaded",function(){
      const canvas=document.getElementById("soundWaveCanvas");if(!canvas)return
      const ctx=canvas.getContext("2d")
      const cell=20
      const glyphs=["0","1"]
      const words=["Hatsune Miku","Digital Diva","CV01","39"]
      let cols=0;let y=[],speed=[],hold=[],last=[]
      function resize(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;cols=Math.floor(canvas.width/cell);y=new Array(cols).fill(0);speed=Array.from({length:cols},()=>Math.random()*0.5+0.5);hold=new Array(cols).fill(0);last=new Array(cols).fill("0")}
      function rgba(hex,a){const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);return`rgba(${r}, ${g}, ${b}, ${a})`}
      resize();window.addEventListener("resize",resize)
      const palette=["#00C6FF","#FF4081"]
      function draw(){
        ctx.fillStyle="rgba(0,0,0,0.05)";ctx.fillRect(0,0,canvas.width,canvas.height)
        ctx.font=`${cell}px monospace`
        ctx.shadowColor="rgba(0,0,0,0.8)";ctx.shadowBlur=4
        const trail=6
        for(let c=0;c<cols;c++){
          let ch
          if(hold[c]>0){ch=last[c];hold[c]--}
          else if(Math.random()<0.02){ch=words[Math.floor(Math.random()*words.length)];hold[c]=Math.max(2,Math.ceil(ch.length*3));last[c]=ch}
          else{ch=glyphs[Math.floor(Math.random()*glyphs.length)];last[c]=ch}
          const x=c*cell
          const py=Math.floor(y[c])*cell
          ctx.fillStyle=palette[c%palette.length];ctx.fillText(ch,x,py)
          for(let t=1;t<=trail;t++){
            const ty=py-t*cell;if(ty<0)break
            const fade=1-t/(trail+1)
            ctx.fillStyle=rgba(palette[c%palette.length],fade*0.9)
            ctx.fillText(glyphs[Math.floor(Math.random()*glyphs.length)],x,ty)
          }
          if(py>canvas.height&&Math.random()>0.975){y[c]=0;speed[c]=Math.random()*0.1+0.1;hold[c]=0;last[c]="0"}
          y[c]+=speed[c]
        }
        requestAnimationFrame(draw)
      }
      requestAnimationFrame(draw)
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded",function(){
      function send(){fetch("/track-visitor",{method:"POST",keepalive:true}).catch(()=>{})}
      send()
      document.addEventListener("visibilitychange",function(){if(document.visibilityState==="hidden"){if(navigator.sendBeacon)navigator.sendBeacon("/track-visitor")}})
    });
  </script>
</body>
</html>


